<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mix Crush</title>
    <meta name="theme-color" content="#ff6b9d">
    <style>
        /* === TEMEL STƒ∞LLER === */
        :root {
            --primary: #ff6b9d;
            --secondary: #4ecdc4;
            --accent: #ffe66d;
            --danger: #ff5252;
            --success: #4caf50;
            --warning: #ff9800;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --board-bg: rgba(255, 255, 255, 0.95);
            --candy-size: 50px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --dark-bg: #1a1a2e;
            --dark-card: #16213e;
            --dark-text: #e0e0e0;
            --dark-border: #2d3047;
            --gold: #ffd700;
            --rainbow: linear-gradient(45deg, #ff0000, #ff8800, #ffff00, #00ff00, #0088ff, #8800ff, #ff0088);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            touch-action: none;
            overscroll-behavior: none;
            padding: 0;
            margin: 0;
        }

        /* === EKRAN Sƒ∞STEMƒ∞ === */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            background: var(--bg-gradient);
            padding: 15px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .screen.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* === ANA MEN√ú === */
        .start-container {
            width: 100%;
            max-width: 450px;
            padding: 20px;
            text-align: center;
        }

        .start-logo {
            font-size: 70px;
            animation: bounce 2s infinite alternate;
            margin-bottom: 20px;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .start-title {
            font-size: 36px;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 800;
        }

        .start-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 30px;
        }

        .start-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            margin: 0 auto;
        }

        .start-btn {
            padding: 16px 20px;
            font-size: 17px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .start-btn-primary {
            background: linear-gradient(135deg, var(--primary), #ff4081);
            color: white;
        }

        .start-btn-secondary {
            background: rgba(255,255,255,0.95);
            color: #333;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        /* === Dƒ∞L SE√áƒ∞Mƒ∞ === */
        .lang-selector {
            position: relative;
            width: 100%;
            margin: 20px 0 15px;
        }

        .lang-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: 2px solid transparent;
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            width: 100%;
            justify-content: center;
            font-size: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .lang-btn:hover {
            background: linear-gradient(135deg, #ff4081, var(--secondary));
            transform: scale(1.02);
        }

        .lang-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 5px;
            background: white;
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 10px 0;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            z-index: 9999;
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .lang-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .lang-option {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            color: #333;
        }

        .lang-option:hover {
            background: rgba(0,0,0,0.05);
        }

        .lang-option.active {
            background: var(--primary);
            color: white;
        }

        .lang-flag {
            font-size: 20px;
        }

        .lang-name {
            font-size: 14px;
            font-weight: 500;
        }

        /* === ≈ûEKƒ∞L SE√áƒ∞M === */
        .shape-container {
            width: 100%;
            max-width: 450px;
            padding: 20px;
            text-align: center;
        }

        .shape-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
            justify-items: center;
            align-items: center;
        }

        .shape-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 25px 15px;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 90px;
            height: 90px;
        }

        .shape-btn.active {
            border-color: var(--accent);
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255,230,109,0.7);
        }

        /* === SEVƒ∞YELER EKRANI === */
        .levels-container {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .levels-header {
            flex-shrink: 0;
            margin-bottom: 15px;
        }

        .levels-grid-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px 5px;
        }

        .levels-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 0 auto;
            max-width: 400px;
        }

        .level-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 5px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            min-width: 0;
            min-height: 0;
        }

        .level-btn:hover:not(.locked) {
            transform: scale(1.05);
        }

        .level-btn.completed {
            box-shadow: 0 0 0 3px var(--accent);
        }

        .level-btn.locked {
            background: linear-gradient(135deg, #666, #888);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .level-time {
            font-size: 10px;
            margin-top: 4px;
            color: var(--accent);
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .level-stars {
            font-size: 10px;
            color: var(--gold);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .level-number {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        /* === OYUN EKRANI === */
        #top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            z-index: 1000;
        }

        .top-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .top-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        #mode-indicator {
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        #game-container {
            width: 100%;
            max-width: 450px;
            background: var(--board-bg);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            margin-top: 70px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .game-header {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .header-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 10px 6px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .header-label {
            font-size: 10px;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .header-value {
            font-size: 18px;
            font-weight: 800;
            line-height: 1;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 2px;
            background: #e0e0e0;
            padding: 10px;
            border-radius: 12px;
            margin: 0 auto 15px;
            width: 100%;
            max-width: 100%;
            aspect-ratio: 1;
            overflow: hidden;
        }

        .candy {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .candy::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
            border-radius: 8px;
        }

        .candy:hover {
            transform: scale(1.05);
        }

        .candy.selected {
            animation: pulse 1s infinite;
            box-shadow: 0 0 20px rgba(255,255,255,0.8), 0 0 0 3px var(--accent);
            z-index: 10;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        .candy.matched {
            animation: match 0.6s ease-out forwards;
        }

        @keyframes match {
            0% { transform: scale(1) rotate(0); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.7; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }

        /* === √ñZEL ≈ûEKER STƒ∞LLERƒ∞ === */
        .candy.special-striped {
            background: var(--rainbow) !important;
            animation: rainbowGlow 2s infinite alternate;
        }

        .candy.special-wrapped {
            background: repeating-linear-gradient(
                45deg,
                var(--primary),
                var(--primary) 10px,
                var(--secondary) 10px,
                var(--secondary) 20px
            ) !important;
            animation: spin 3s infinite linear;
        }

        .candy.special-color-bomb {
            background: linear-gradient(45deg, #ff0000, #00ff00, #0000ff) !important;
            animation: bombPulse 1.5s infinite;
        }

        .candy.special-fish {
            background: linear-gradient(135deg, #36D1DC, #5B86E5) !important;
            animation: fishSwim 2s infinite alternate;
        }

        .candy.special-coconut {
            background: linear-gradient(135deg, #8B4513, #D2691E) !important;
            animation: coconutShake 1s infinite;
        }

        @keyframes rainbowGlow {
            0% { filter: brightness(1) saturate(1); }
            100% { filter: brightness(1.2) saturate(1.5); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes bombPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px #ff0000; }
            50% { transform: scale(1.1); box-shadow: 0 0 20px #ff0000, 0 0 30px #ff0000; }
        }

        @keyframes fishSwim {
            0% { transform: translateY(-3px) rotate(-5deg); }
            100% { transform: translateY(3px) rotate(5deg); }
        }

        @keyframes coconutShake {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        /* === BOOSTER'LAR === */
        .boosters-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .booster-btn {
            background: linear-gradient(135deg, var(--accent), var(--primary));
            border: none;
            border-radius: 12px;
            width: 70px;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            position: relative;
        }

        .booster-btn:hover:not(.disabled) {
            transform: scale(1.05);
        }

        .booster-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .booster-btn.out-of-stock {
            background: linear-gradient(135deg, #cccccc, #999999);
        }

        .booster-btn .add-plus {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--success);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            animation: addPlusPulse 1.5s infinite;
            z-index: 10;
        }

        @keyframes addPlusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .booster-icon {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .booster-count {
            font-size: 16px;
            font-weight: 700;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 2px 8px;
            min-width: 25px;
        }

        /* === BOOSTER A√áIKLAMA Bƒ∞LDƒ∞Rƒ∞Mƒ∞ === */
        .booster-info {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 18px;
            border-radius: 15px;
            font-weight: 600;
            z-index: 3001;
            transition: transform 0.3s ease, opacity 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            max-width: 300px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            font-size: 14px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .booster-info.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* === MODALLAR === */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 15px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 450px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 24px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .setting-item label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        /* === ƒ∞STATƒ∞STƒ∞KLER === */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 12px 8px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.9;
        }

        .level-time-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .level-time-number {
            font-weight: bold;
            color: var(--primary);
            min-width: 30px;
        }

        .level-time-value {
            font-family: monospace;
            color: #333;
        }

        /* === OYUN Bƒ∞TTƒ∞ MODALI === */
        .game-over-content {
            text-align: center;
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
            font-size: 14px;
        }

        .result-stat {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 10px;
            font-weight: 600;
        }

        .result-stat-value {
            color: var(--primary);
            font-size: 18px;
            margin-top: 5px;
        }

        /* === TOAST MESAJI === */
        .toast {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--success);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 3000;
            transition: transform 0.3s ease;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            max-width: 85%;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            font-size: 14px;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* === ONAY MODALI === */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            padding: 15px;
        }

        .confirm-modal.active {
            display: flex;
        }

        .confirm-content {
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .confirm-content h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 12px;
        }

        .confirm-content p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.4;
            font-size: 14px;
        }

        .confirm-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 90px;
        }

        .confirm-btn-yes {
            background: var(--success);
            color: white;
        }

        .confirm-btn-no {
            background: var(--danger);
            color: white;
        }

        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }

        /* === BOOSTER REKLAM MODALI (YENƒ∞ D√úZENLENDƒ∞) === */
        .ad-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            padding: 15px;
            backdrop-filter: blur(10px);
        }

        .ad-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .ad-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 30px 25px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.2);
            animation: scaleIn 0.4s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .ad-content h3 {
            font-size: 24px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .ad-content p {
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: 16px;
            opacity: 0.9;
        }

        .ad-loader {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            border-top-color: var(--accent);
            border-right-color: var(--accent);
            animation: adSpin 1s linear infinite;
            margin: 20px auto;
            box-shadow: 0 0 20px rgba(255,230,109,0.3);
        }

        @keyframes adSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .ad-countdown {
            font-size: 52px;
            font-weight: 900;
            color: var(--accent);
            text-shadow: 0 0 20px rgba(255,215,0,0.7);
            margin: 15px 0;
            animation: countdownPulse 1s infinite;
        }

        @keyframes countdownPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .ad-footer {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 15px;
        }

        /* === KARANLIK MOD === */
        body.dark-mode {
            --bg-gradient: linear-gradient(135deg, var(--dark-bg) 0%, var(--dark-card) 100%);
            --board-bg: var(--dark-card);
        }

        body.dark-mode .modal-content {
            background: var(--dark-card);
            color: var(--dark-text);
        }

        body.dark-mode .modal-header h2 {
            color: var(--dark-text);
        }

        body.dark-mode .close-btn {
            color: var(--dark-text);
        }

        body.dark-mode .close-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        body.dark-mode .setting-item {
            background: rgba(255,255,255,0.1);
            color: var(--dark-text);
        }

        body.dark-mode .setting-item label {
            color: var(--dark-text);
        }

        body.dark-mode .level-time-item {
            background: rgba(255,255,255,0.1);
            color: var(--dark-text);
        }

        body.dark-mode .level-time-number {
            color: var(--accent);
        }

        body.dark-mode .level-time-value {
            color: var(--dark-text);
        }

        body.dark-mode .result-stat {
            background: rgba(255,255,255,0.1);
            color: var(--dark-text);
        }

        body.dark-mode .result-stat-value {
            color: var(--accent);
        }

        body.dark-mode .confirm-content {
            background: var(--dark-card);
            color: var(--dark-text);
        }

        body.dark-mode .confirm-content h3 {
            color: var(--dark-text);
        }

        body.dark-mode .confirm-content p {
            color: rgba(255,255,255,0.8);
        }

        body.dark-mode .level-btn.locked {
            background: linear-gradient(135deg, #444, #666);
        }

        body.dark-mode .lang-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: rgba(255,255,255,0.2);
        }

        body.dark-mode .lang-btn:hover {
            background: linear-gradient(135deg, #ff4081, var(--secondary));
        }

        body.dark-mode .lang-dropdown {
            background: var(--dark-card);
            border: 1px solid rgba(255,255,255,0.1);
        }

        body.dark-mode .lang-option {
            color: var(--dark-text);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        body.dark-mode .lang-option:hover {
            background: rgba(255,255,255,0.1);
        }

        body.dark-mode .lang-option.active {
            background: var(--primary);
            color: white;
        }

        body.dark-mode .ad-content {
            background: linear-gradient(135deg, var(--dark-bg), var(--dark-card));
            border: 1px solid var(--primary);
        }

        /* === MOBƒ∞L UYUMLULUK === */
        @media (max-width: 768px) {
            :root {
                --candy-size: min(45px, calc((100vw - 60px) / 8 - 4px));
            }
            
            #game-board {
                gap: 1px;
                padding: 8px;
            }
            
            .candy {
                font-size: 22px;
                border-radius: 6px;
            }
            
            .shape-btn {
                width: 80px;
                height: 80px;
                font-size: 32px;
                padding: 20px 10px;
            }
            
            .levels-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
                max-width: 350px;
            }
            
            .level-btn {
                padding: 12px 4px;
                font-size: 16px;
            }
            
            .levels-grid-container {
                padding: 5px;
            }
            
            .lang-selector {
                margin: 15px 0 10px;
            }
            
            .lang-btn {
                padding: 10px 16px;
            }
            
            .ad-content {
                padding: 25px 20px;
            }
            
            .ad-countdown {
                font-size: 48px;
            }
        }

        @media (max-width: 480px) {
            .start-container {
                padding: 15px;
            }
            
            .start-title {
                font-size: 28px;
            }
            
            .start-logo {
                font-size: 50px;
            }
            
            .start-btn {
                padding: 14px 16px;
                font-size: 15px;
            }
            
            .game-header {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
            }
            
            .header-card {
                padding: 8px 4px;
            }
            
            .header-label {
                font-size: 9px;
            }
            
            .header-value {
                font-size: 16px;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .shape-btn {
                width: 70px;
                height: 70px;
                font-size: 28px;
                padding: 18px 8px;
            }
            
            #game-container {
                margin-top: 60px;
                padding: 10px;
            }
            
            .candy {
                font-size: 20px;
            }
            
            .booster-btn {
                width: 65px;
                height: 65px;
            }
            
            .booster-icon {
                font-size: 24px;
            }
            
            .levels-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 6px;
                max-width: 320px;
            }
            
            .level-btn {
                padding: 10px 3px;
                font-size: 14px;
            }
            
            .levels-container {
                padding: 15px;
            }
            
            .levels-header {
                margin-bottom: 10px;
            }
            
            .lang-selector {
                margin: 12px 0 8px;
            }
            
            .lang-btn {
                padding: 8px 14px;
                font-size: 14px;
            }
            
            .lang-dropdown {
                max-height: 300px;
            }
            
            .ad-content {
                padding: 20px 15px;
            }
            
            .ad-content h3 {
                font-size: 22px;
            }
            
            .ad-countdown {
                font-size: 42px;
            }
            
            .ad-loader {
                width: 60px;
                height: 60px;
            }
        }

        @media (max-width: 380px) {
            :root {
                --candy-size: min(40px, calc((100vw - 50px) / 8 - 3px));
            }
            
            .start-title {
                font-size: 24px;
            }
            
            .game-header {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            #game-board {
                padding: 6px;
                gap: 1px;
            }
            
            .candy {
                font-size: 18px;
            }
            
            .shape-btn {
                width: 65px;
                height: 65px;
                font-size: 26px;
                padding: 16px 8px;
            }
            
            .booster-btn {
                width: 60px;
                height: 60px;
            }
            
            .booster-icon {
                font-size: 22px;
            }
            
            .levels-grid {
                grid-template-columns: repeat(4, 1fr);
                max-width: 280px;
            }
            
            .level-btn {
                font-size: 13px;
            }
            
            .lang-btn {
                padding: 7px 12px;
            }
            
            .ad-countdown {
                font-size: 38px;
            }
        }

        @media (max-width: 320px) {
            :root {
                --candy-size: min(36px, calc((100vw - 40px) / 8 - 2px));
            }
            
            .shape-grid {
                grid-template-columns: repeat(3, 1fr);
                max-width: 100%;
                gap: 12px;
            }
            
            .shape-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
                padding: 15px 5px;
            }
            
            .candy {
                font-size: 16px;
            }
            
            .booster-btn {
                width: 55px;
                height: 55px;
            }
            
            .booster-icon {
                font-size: 20px;
            }
            
            .levels-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
                max-width: 260px;
            }
            
            .level-btn {
                padding: 8px 2px;
                font-size: 12px;
            }
            
            .lang-btn {
                padding: 6px 10px;
                font-size: 13px;
            }
            
            .ad-content h3 {
                font-size: 20px;
            }
            
            .ad-countdown {
                font-size: 34px;
            }
        }

        /* === YARDIMCI SINIFLAR === */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mt-20 { margin-top: 20px; }
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
        
        /* === SCROLLBAR === */
        .screen::-webkit-scrollbar {
            width: 6px;
        }
        
        .screen::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .screen::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .screen::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .levels-grid-container::-webkit-scrollbar {
            width: 4px;
        }
        
        .levels-grid-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .levels-grid-container::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
        }
        
        .levels-grid-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
        
        body.dark-mode .screen::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
        }
        
        body.dark-mode .screen::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
        }
        
        body.dark-mode .screen::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
        
        body.dark-mode .levels-grid-container::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
        }
        
        body.dark-mode .levels-grid-container::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.15);
        }
        
        body.dark-mode .levels-grid-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .levels-grid-container {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <!-- ANA MEN√ú -->
    <div id="start-screen" class="screen active">
        <div class="start-container">
            <div class="start-logo">üîÄ</div>
            <h1 class="start-title" data-i18n="game_title">MIX CRUSH</h1>
            <p class="start-subtitle" data-i18n="game_subtitle">Mix, Match, Win!</p>
            
            <div class="start-buttons">
                <button id="start-btn" class="start-btn start-btn-primary">
                    <span>üéÆ</span> <span data-i18n="play_game">START GAME</span>
                </button>
                <button id="levels-btn" class="start-btn start-btn-secondary">
                    <span>üèÜ</span> <span data-i18n="levels">LEVELS</span>
                </button>
                <button id="stats-btn" class="start-btn start-btn-secondary">
                    <span>üìä</span> <span data-i18n="statistics">STATISTICS</span>
                </button>
                <button id="settings-btn" class="start-btn start-btn-secondary">
                    <span>‚öôÔ∏è</span> <span data-i18n="settings">SETTINGS</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ≈ûEKƒ∞L SE√áƒ∞M -->
    <div id="shape-screen" class="screen">
        <div class="shape-container">
            <div class="start-logo">üé®</div>
            <h1 class="start-title" data-i18n="select_theme">Select Theme</h1>
            <p class="start-subtitle" data-i18n="select_theme_subtitle">Choose your favorite theme and start playing</p>
            
            <div class="shape-grid">
                <button class="shape-btn" data-shape="candy" title="Candies">üç≠</button>
                <button class="shape-btn" data-shape="sports" title="Sports">‚öΩ</button>
                <button class="shape-btn" data-shape="planets" title="Planets">ü™ê</button>
                <button class="shape-btn" data-shape="balloons" title="Balloons">üéà</button>
                <button class="shape-btn" data-shape="letters" title="Letters">üî§</button>
                <button class="shape-btn" data-shape="numbers" title="Numbers">üî¢</button>
                <button class="shape-btn" data-shape="fruits" title="Fruits">üçé</button>
                <button class="shape-btn" data-shape="animals" title="Animals">üê±</button>
                <button class="shape-btn" data-shape="hearts" title="Hearts">üíñ</button>
            </div>
            
            <div class="start-buttons">
                <button id="shape-confirm" class="start-btn start-btn-primary">
                    <span>‚úÖ</span> <span data-i18n="confirm_start">CONFIRM AND START</span>
                </button>
                <button id="back-from-shape" class="start-btn start-btn-secondary">
                    <span>‚Üê</span> <span data-i18n="back">BACK</span>
                </button>
            </div>
        </div>
    </div>

    <!-- SEVƒ∞YELER EKRANI -->
    <div id="levels-screen" class="screen">
        <div class="levels-container">
            <div class="levels-header">
                <div class="start-logo">üèÜ</div>
                <h1 class="start-title" data-i18n="levels">Levels</h1>
                <p class="start-subtitle" id="levels-info">
                    <span data-i18n="open_levels">Open Levels:</span> <span id="open-levels">1</span>/100
                </p>
            </div>
            
            <div class="levels-grid-container">
                <div class="levels-grid" id="levels-grid">
                    <!-- Seviyeler JavaScript ile buraya eklenecek -->
                </div>
            </div>
            
            <div class="start-buttons">
                <button id="back-from-levels" class="start-btn start-btn-secondary">
                    <span>‚Üê</span> <span data-i18n="main_menu">MAIN MENU</span>
                </button>
            </div>
        </div>
    </div>

    <!-- OYUN EKRANI -->
    <div id="game-screen" class="screen">
        <div id="top-bar">
            <button id="home-btn" class="top-btn" title="Main Menu" data-i18n-title="main_menu">üè†</button>
            <div id="mode-indicator" data-i18n="level">Level 1</div>
            <button id="game-settings-btn" class="top-btn" title="Settings" data-i18n-title="settings">‚öôÔ∏è</button>
        </div>
        
        <div id="game-container">
            <div class="game-header">
                <div class="header-card">
                    <div class="header-label" data-i18n="level">LEVEL</div>
                    <div class="header-value" id="level-display">1</div>
                </div>
                <div class="header-card">
                    <div class="header-label" data-i18n="score">SCORE</div>
                    <div class="header-value" id="score-display">0</div>
                </div>
                <div class="header-card">
                    <div class="header-label" data-i18n="moves">MOVES</div>
                    <div class="header-value" id="moves-display">30</div>
                </div>
                <div class="header-card time-card">
                    <div class="header-label" data-i18n="time">TIME</div>
                    <div class="header-value" id="time-display">0:00</div>
                </div>
            </div>
            
            <div id="game-board">
                <!-- Oyun tahtasƒ± JavaScript ile olu≈üturulacak -->
            </div>
            
            <div class="boosters-container">
                <button class="booster-btn" data-booster="hammer" data-i18n-title="hammer_desc">
                    <div class="booster-icon">üî®</div>
                    <div class="booster-count" id="hammer-count">3</div>
                </button>
                <button class="booster-btn" data-booster="bomb" data-i18n-title="bomb_desc">
                    <div class="booster-icon">üí£</div>
                    <div class="booster-count" id="bomb-count">2</div>
                </button>
                <button class="booster-btn" data-booster="shuffle" data-i18n-title="shuffle_desc">
                    <div class="booster-icon">üîÄ</div>
                    <div class="booster-count" id="shuffle-count">1</div>
                </button>
                <button class="booster-btn" data-booster="fish" data-i18n-title="fish_desc">
                    <div class="booster-icon">üêü</div>
                    <div class="booster-count" id="fish-count">2</div>
                </button>
                <button class="booster-btn" data-booster="coconut" data-i18n-title="coconut_desc">
                    <div class="booster-icon">ü••</div>
                    <div class="booster-count" id="coconut-count">1</div>
                </button>
            </div>
        </div>
    </div>

    <!-- BOOSTER A√áIKLAMA Bƒ∞LDƒ∞Rƒ∞Mƒ∞ -->
    <div id="booster-info" class="booster-info"></div>

    <!-- AYARLAR MODALI -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="game_settings">Mix Crush Settings</h2>
                <button class="close-btn" id="close-settings">√ó</button>
            </div>
            
            <!-- Dƒ∞L SE√áƒ∞Mƒ∞ (AYARLAR ƒ∞√áƒ∞NE TA≈ûINDI) -->
            <h3 data-i18n="language_settings">üåê Language Settings</h3>
            <div class="lang-selector">
                <button id="lang-btn" class="lang-btn">
                    <span id="current-lang-flag">üá¨üáß</span>
                    <span id="current-lang-name">English</span>
                    <span style="font-size:12px; margin-left: auto;">‚ñº</span>
                </button>
                <div id="lang-dropdown" class="lang-dropdown">
                    <!-- Diller JavaScript ile eklenecek -->
                </div>
            </div>
            
            <h3 data-i18n="sound_settings">üîä Sound Settings</h3>
            <div class="setting-item">
                <label data-i18n="sound_effects">Sound Effects</label>
                <input type="range" id="sfx-volume" min="0" max="100" value="70">
                <span id="sfx-value">70%</span>
            </div>
            
            <div class="setting-item">
                <label data-i18n="music">Music</label>
                <input type="range" id="music-volume" min="0" max="100" value="50">
                <span id="music-value">50%</span>
            </div>
            
            <h3 data-i18n="appearance">üé® Appearance</h3>
            <div class="setting-item">
                <label data-i18n="visual_effects">Visual Effects</label>
                <input type="checkbox" id="effects-toggle" checked>
            </div>
            
            <div class="setting-item">
                <label data-i18n="dark_mode">Dark Mode</label>
                <input type="checkbox" id="dark-mode-toggle">
            </div>
            
            <h3 data-i18n="data_management">üîÑ Data Management</h3>
            <div class="setting-item">
                <label data-i18n="reset_all_data">Reset All Data</label>
                <button id="reset-btn" class="start-btn start-btn-secondary" style="padding: 8px 16px; font-size: 14px;" data-i18n="reset">Reset</button>
            </div>
            
            <button id="close-settings-btn" class="start-btn start-btn-primary mt-20" style="width: 100%;">
                <span>‚úÖ</span> <span data-i18n="ok">OK</span>
            </button>
        </div>
    </div>

    <!-- ƒ∞STATƒ∞STƒ∞KLER MODALI -->
    <div id="stats-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="game_statistics">Mix Crush Statistics</h2>
                <button class="close-btn" id="close-stats">√ó</button>
            </div>
            
            <h3 data-i18n="general_statistics">üìà General Statistics</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-games">0</div>
                    <div class="stat-label" data-i18n="total_games">Total Games</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-score">0</div>
                    <div class="stat-label" data-i18n="total_score">Total Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-time">0</div>
                    <div class="stat-label" data-i18n="total_time">Total Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="best-combo">0</div>
                    <div class="stat-label" data-i18n="best_combo">Best Combo</div>
                </div>
            </div>
            
            <h3 data-i18n="best_scores">üèÜ Best Scores</h3>
            <div class="setting-item">
                <label data-i18n="highest_score">Highest Score</label>
                <span id="best-score">0</span>
            </div>
            <div class="setting-item">
                <label data-i18n="fastest_level">Fastest Level</label>
                <span id="fastest-level">-</span>
            </div>
            <div class="setting-item">
                <label data-i18n="completed_levels">Completed Levels</label>
                <span id="completed-levels">0/100</span>
            </div>
            
            <h3 data-i18n="level_times">‚è±Ô∏è Level Times</h3>
            <div id="level-times" style="max-height: 200px; overflow-y: auto;">
                <div class="text-center" style="color:#999; padding:15px; font-size:14px;" data-i18n="no_levels_completed">
                    No levels completed yet
                </div>
            </div>
            
            <h3 data-i18n="special_stats">‚ú® Special Statistics</h3>
            <div class="setting-item">
                <label data-i18n="specials_created">Specials Created</label>
                <span id="total-specials">0</span>
            </div>
            <div class="setting-item">
                <label data-i18n="matches_made">Matches Made</label>
                <span id="total-matches">0</span>
            </div>
        </div>
    </div>

    <!-- OYUN Bƒ∞TTƒ∞ MODALI -->
    <div id="game-over-modal" class="modal">
        <div class="modal-content game-over-content">
            <h2 id="game-over-title">üéâ <span data-i18n="level_completed">Level Completed!</span></h2>
            
            <div style="font-size: 22px; text-align: center; margin: 15px 0; font-weight: bold;">
                <span data-i18n="score">Score:</span> <span id="final-score">0</span>
            </div>
            
            <div class="result-stats">
                <div class="result-stat">
                    <div data-i18n="time">‚è±Ô∏è Time</div>
                    <div class="result-stat-value" id="level-time">0:00</div>
                </div>
                <div class="result-stat">
                    <div data-i18n="combo">üî• Combo</div>
                    <div class="result-stat-value" id="max-combo">0x</div>
                </div>
                <div class="result-stat">
                    <div data-i18n="special">üíé Special</div>
                    <div class="result-stat-value" id="special-count">0</div>
                </div>
                <div class="result-stat">
                    <div data-i18n="efficiency">üéØ Efficiency</div>
                    <div class="result-stat-value" id="efficiency">0%</div>
                </div>
            </div>
            
            <div class="start-buttons">
                <button id="next-level-btn" class="start-btn start-btn-primary">
                    <span>‚û°Ô∏è</span> <span data-i18n="next_level">NEXT LEVEL</span>
                </button>
                <button id="restart-level-btn" class="start-btn start-btn-secondary">
                    <span>üîÑ</span> <span data-i18n="play_again">PLAY AGAIN</span>
                </button>
                <button id="back-to-levels-btn" class="start-btn start-btn-secondary">
                    <span>üèÜ</span> <span data-i18n="levels">LEVELS</span>
                </button>
                <button id="back-to-menu-btn" class="start-btn start-btn-secondary">
                    <span>üè†</span> <span data-i18n="main_menu">MAIN MENU</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ONAY MODALI -->
    <div id="confirm-modal" class="confirm-modal">
        <div class="confirm-content">
            <h3 id="confirm-title" data-i18n="confirmation">Confirmation</h3>
            <p id="confirm-message" data-i18n="confirm_question">Do you want to continue?</p>
            <div class="confirm-buttons">
                <button id="confirm-yes" class="confirm-btn confirm-btn-yes" data-i18n="yes">Yes</button>
                <button id="confirm-no" class="confirm-btn confirm-btn-no" data-i18n="no">No</button>
            </div>
        </div>
    </div>

    <!-- BOOSTER REKLAM MODALI (YENƒ∞ - D√úZELTƒ∞LDƒ∞) -->
    <div id="ad-modal" class="ad-modal">
        <div class="ad-content">
            <h3 id="ad-title" data-i18n="get_booster">üéÅ Get Mix Crush Booster!</h3>
            <p id="ad-message" data-i18n="watch_ad_for_booster">Watch ad to get 1 free booster.</p>
            
            <div class="ad-loader"></div>
            
            <div class="ad-countdown-container">
                <div style="font-size: 16px; margin-bottom: 10px;">‚è≥</div>
                <div class="ad-countdown" id="ad-countdown">5</div>
                <div style="font-size: 14px; margin-top: 10px; opacity: 0.8;" data-i18n="seconds">seconds</div>
            </div>
            
            <div style="font-size: 14px; margin: 15px 0; opacity: 0.9;" data-i18n="ad_closing">This window will close automatically...</div>
            
            <div class="confirm-buttons">
                <button id="watch-ad-btn" class="confirm-btn confirm-btn-yes" data-i18n="watch_ad">Watch Ad</button>
                <button id="cancel-ad-btn" class="confirm-btn confirm-btn-no" data-i18n="cancel">Cancel</button>
            </div>
            
            <div class="ad-footer">
                Mix Crush - <span data-i18n="advertisement">Advertisement</span>
            </div>
        </div>
    </div>

    <!-- TOAST MESAJI -->
    <div class="toast" id="toast"></div>

    <script>
        // === √áOK Dƒ∞LLƒ∞ YAPI ===
        class LanguageManager {
            constructor() {
                this.languages = {
                    'en': { // English
                        code: 'en',
                        name: 'English',
                        flag: 'üá¨üáß',
                        direction: 'ltr',
                        translations: {
                            'game_title': 'MIX CRUSH',
                            'game_subtitle': 'Mix, Match, Win!',
                            'play_game': 'START GAME',
                            'levels': 'LEVELS',
                            'statistics': 'STATISTICS',
                            'settings': 'SETTINGS',
                            'main_menu': 'MAIN MENU',
                            'back': 'BACK',
                            'ok': 'OK',
                            'yes': 'Yes',
                            'no': 'No',
                            'cancel': 'Cancel',
                            'confirm': 'Confirm',
                            'close': 'Close',
                            'advertisement': 'Advertisement',
                            'seconds': 'seconds',
                            'language_settings': 'üåê Language Settings',
                            'select_theme': 'Select Theme',
                            'select_theme_subtitle': 'Choose your favorite theme and start playing',
                            'confirm_start': 'CONFIRM AND START',
                            'level': 'LEVEL',
                            'score': 'SCORE',
                            'moves': 'MOVES',
                            'time': 'TIME',
                            'level_x': 'Level {0}',
                            'hammer_desc': 'Break single candy',
                            'bomb_desc': 'Clear 3x3 area',
                            'shuffle_desc': 'Shuffle board',
                            'fish_desc': 'Clear random candies',
                            'coconut_desc': 'Clear column',
                            'game_settings': 'Mix Crush Settings',
                            'sound_settings': 'üîä Sound Settings',
                            'sound_effects': 'Sound Effects',
                            'music': 'Music',
                            'appearance': 'üé® Appearance',
                            'visual_effects': 'Visual Effects',
                            'dark_mode': 'Dark Mode',
                            'data_management': 'üîÑ Data Management',
                            'reset_all_data': 'Reset All Data',
                            'reset': 'Reset',
                            'game_statistics': 'Mix Crush Statistics',
                            'general_statistics': 'üìà General Statistics',
                            'total_games': 'Total Games',
                            'total_score': 'Total Score',
                            'total_time': 'Total Time',
                            'best_combo': 'Best Combo',
                            'best_scores': 'üèÜ Best Scores',
                            'highest_score': 'Highest Score',
                            'fastest_level': 'Fastest Level',
                            'completed_levels': 'Completed Levels',
                            'level_times': '‚è±Ô∏è Level Times',
                            'no_levels_completed': 'No levels completed yet',
                            'special_stats': '‚ú® Special Statistics',
                            'specials_created': 'Specials Created',
                            'matches_made': 'Matches Made',
                            'level_completed': 'Level Completed!',
                            'game_over': 'Game Over!',
                            'next_level': 'NEXT LEVEL',
                            'play_again': 'PLAY AGAIN',
                            'combo': 'Combo',
                            'special': 'Special',
                            'efficiency': 'Efficiency',
                            'confirmation': 'Confirmation',
                            'confirm_question': 'Do you want to continue?',
                            'get_booster': 'üéÅ Get Mix Crush Booster!',
                            'watch_ad_for_booster': 'Watch ad to get 1 free booster.',
                            'watch_ad': 'Watch Ad',
                            'open_levels': 'Open Levels',
                            'ad_cancelled': 'Ad viewing cancelled.',
                            'ad_watched': 'Ad watched! Booster added.',
                            'booster_added': '+1 {0} earned!',
                            'exit_game': 'Exit Game',
                            'exit_confirm': 'Are you sure you want to exit Mix Crush game? Unsaved progress may be lost.',
                            'reset_data': 'Reset Data',
                            'reset_confirm': 'All Mix Crush game data will be deleted. This action cannot be undone. Are you sure?',
                            'level_start': 'Mix Crush Level {0} started!',
                            'booster_active': 'Booster active! Click a candy.',
                            'booster_cancelled': 'Booster cancelled.',
                            'hammer_info': 'üî® Hammer: Use to break a single candy. Click a candy when active.',
                            'bomb_info': 'üí£ Bomb: Clears candies in 3x3 area. Click a candy when active.',
                            'shuffle_info': 'üîÄ Shuffle: Shuffles all candies. Takes effect immediately.',
                            'fish_info': 'üêü Fish: Clears 3 random candies. Click a candy when active.',
                            'coconut_info': 'ü•• Coconut: Clears entire column. Click a candy when active.',
                            'language_changed': 'Language changed!',
                            'two_specials_combined': 'Two specials combined',
                            'mega_explosion': 'Mega explosion',
                            'all_same_color_striped': 'All same color striped',
                            'cross_clean': 'Cross clean',
                            'big_explosion': 'Big explosion',
                            'fish_swarm': 'Fish swarm',
                            'double_column_clean': 'Double column clean',
                            'row_cleared': 'Row cleared',
                            'column_cleared': 'Column cleared',
                            'area_cleared': 'Area cleared',
                            'all_candies_cleared': 'All {0} candies cleared',
                            'fish_ate_candies': 'Fish ate candies',
                            'coconut_cleared_column': 'Coconut cleared column',
                            'awesome_5_matches': 'Awesome! 5+ matches!',
                            'great_4_matches': 'Great! 4 matches!',
                            'combo_x': 'Combo {0}',
                            'color_bomb_created': 'Color bomb created!',
                            'striped_candy_created': 'Striped candy created!',
                            'wrapped_candy_created': 'Wrapped candy created!',
                            'fish_created': 'Fish created!',
                            'coconut_created': 'Coconut created!',
                            'board_shuffled': 'Board shuffled',
                            'watching_ad': 'Watching ad...',
                            'ad_title': 'Mix Crush Ad',
                            'ad_text': 'Thanks for watching! You earned a booster.',
                            'ad_closing': 'This window will close automatically...',
                            'out_of_stock': 'Out of stock'
                        }
                    },
                    'tr': { // T√ºrk√ße
                        code: 'tr',
                        name: 'T√ºrk√ße',
                        flag: 'üáπüá∑',
                        direction: 'ltr',
                        translations: {
                            'game_title': 'MIX CRUSH',
                            'game_subtitle': 'Karƒ±≈ütƒ±r, E≈üle≈ütir, Kazan!',
                            'play_game': 'OYUNA BA≈ûLA',
                            'levels': 'SEVƒ∞YELER',
                            'statistics': 'ƒ∞STATƒ∞STƒ∞KLER',
                            'settings': 'AYARLAR',
                            'main_menu': 'ANA MEN√ú',
                            'back': 'GERƒ∞',
                            'ok': 'TAMAM',
                            'yes': 'Evet',
                            'no': 'Hayƒ±r',
                            'cancel': 'ƒ∞ptal',
                            'confirm': 'Onayla',
                            'close': 'Kapat',
                            'advertisement': 'Reklam',
                            'seconds': 'saniye',
                            'language_settings': 'üåê Dil Ayarlarƒ±',
                            'select_theme': 'Tema Se√ß',
                            'select_theme_subtitle': 'Favori temanƒ± se√ß ve oyuna ba≈üla',
                            'confirm_start': 'ONAYLA VE BA≈ûLA',
                            'level': 'SEVƒ∞YE',
                            'score': 'PUAN',
                            'moves': 'HAMLE',
                            'time': 'S√úRE',
                            'level_x': 'Seviye {0}',
                            'hammer_desc': 'Tek ≈üeker kƒ±r',
                            'bomb_desc': '3x3 alanƒ± temizle',
                            'shuffle_desc': 'Tahtayƒ± karƒ±≈ütƒ±r',
                            'fish_desc': 'Rastgele ≈üekerleri temizle',
                            'coconut_desc': 'S√ºtun temizle',
                            'game_settings': 'Mix Crush Ayarlarƒ±',
                            'sound_settings': 'üîä Ses Ayarlarƒ±',
                            'sound_effects': 'Ses Efektleri',
                            'music': 'M√ºzik',
                            'appearance': 'üé® G√∂r√ºn√ºm',
                            'visual_effects': 'G√∂rsel Efektler',
                            'dark_mode': 'Karanlƒ±k Mod',
                            'data_management': 'üîÑ Veri Y√∂netimi',
                            'reset_all_data': 'T√ºm Verileri Sƒ±fƒ±rla',
                            'reset': 'Sƒ±fƒ±rla',
                            'game_statistics': 'Mix Crush ƒ∞statistikleri',
                            'general_statistics': 'üìà Genel ƒ∞statistikler',
                            'total_games': 'Toplam Oyun',
                            'total_score': 'Toplam Puan',
                            'total_time': 'Toplam S√ºre',
                            'best_combo': 'En ƒ∞yi Combo',
                            'best_scores': 'üèÜ En ƒ∞yi Skorlar',
                            'highest_score': 'En Y√ºksek Puan',
                            'fastest_level': 'En Hƒ±zlƒ± Seviye',
                            'completed_levels': 'Tamamlanan Seviye',
                            'level_times': '‚è±Ô∏è Seviye S√ºreleri',
                            'no_levels_completed': 'Hen√ºz seviye tamamlanmadƒ±',
                            'special_stats': '‚ú® √ñzel ƒ∞statistikler',
                            'specials_created': 'Olu≈üturulan √ñzel ≈ûeker',
                            'matches_made': 'Yapƒ±lan E≈üle≈ütirme',
                            'level_completed': 'Seviye Tamamlandƒ±!',
                            'game_over': 'Oyun Bitti!',
                            'next_level': 'SONRAKƒ∞ SEVƒ∞YE',
                            'play_again': 'TEKRAR OYNA',
                            'combo': 'Combo',
                            'special': '√ñzel',
                            'efficiency': 'Verim',
                            'confirmation': 'Onay',
                            'confirm_question': 'Devam etmek istiyor musunuz?',
                            'get_booster': 'üéÅ Mix Crush Booster Kazan!',
                            'watch_ad_for_booster': 'Reklam izleyerek 1 adet √ºcretsiz booster kazanabilirsin.',
                            'watch_ad': 'Reklam ƒ∞zle',
                            'open_levels': 'A√ßƒ±k Seviyeler',
                            'ad_cancelled': 'Reklam izleme iptal edildi.',
                            'ad_watched': 'Reklam izlendi! Booster eklendi.',
                            'booster_added': '+1 {0} kazandƒ±n!',
                            'exit_game': 'Oyundan √áƒ±k',
                            'exit_confirm': 'Mix Crush oyunundan √ßƒ±kmak istediƒüine emin misin? Kaydedilmemi≈ü ilerlemen kaybolabilir.',
                            'reset_data': 'Verileri Sƒ±fƒ±rla',
                            'reset_confirm': 'T√ºm Mix Crush oyun verileri silinecek. Bu i≈ülem geri alƒ±namaz. Emin misiniz?',
                            'level_start': 'Mix Crush Seviye {0} ba≈üladƒ±!',
                            'booster_active': 'Booster aktif! Bir ≈üekere tƒ±kla.',
                            'booster_cancelled': 'Booster iptal edildi.',
                            'hammer_info': 'üî® √áeki√ß: Tek bir ≈üekeri kƒ±rmak i√ßin kullan. Aktifken bir ≈üekere tƒ±kla.',
                            'bomb_info': 'üí£ Bomba: 3x3 alandaki ≈üekerleri patlatƒ±r. Aktifken bir ≈üekere tƒ±kla.',
                            'shuffle_info': 'üîÄ Karƒ±≈ütƒ±r: T√ºm ≈üekerleri yeniden karƒ±≈ütƒ±rƒ±r. Hemen etki eder.',
                            'fish_info': 'üêü Balƒ±k: Rastgele 3 ≈üekeri temizler. Aktifken bir ≈üekere tƒ±kla.',
                            'coconut_info': 'ü•• Hindistan Cevizi: T√ºm s√ºtunu temizler. Aktifken bir ≈üekere tƒ±kla.',
                            'language_changed': 'Dil deƒüi≈ütirildi!',
                            'two_specials_combined': 'ƒ∞ki √∂zel ≈üeker birle≈ütirildi',
                            'mega_explosion': 'Mega patlama',
                            'all_same_color_striped': 'T√ºm aynƒ± renkler √ßizgili yapƒ±ldƒ±',
                            'cross_clean': '√áapraz temizlik',
                            'big_explosion': 'B√ºy√ºk patlama',
                            'fish_swarm': 'Balƒ±k s√ºr√ºs√º',
                            'double_column_clean': '√áift s√ºtun temizliƒüi',
                            'row_cleared': 'Satƒ±r temizlendi',
                            'column_cleared': 'S√ºtun temizlendi',
                            'area_cleared': 'Alan temizlendi',
                            'all_candies_cleared': 'T√ºm {0} ≈üekerleri temizlendi',
                            'fish_ate_candies': 'Balƒ±k ≈üekerleri yedi',
                            'coconut_cleared_column': 'Hindistan cevizi s√ºtunu temizledi',
                            'awesome_5_matches': 'Harika! 5+ e≈üle≈üme!',
                            'great_4_matches': 'Harika! 4 e≈üle≈üme!',
                            'combo_x': 'Combo {0}',
                            'color_bomb_created': 'Renk bombasƒ± olu≈üturuldu!',
                            'striped_candy_created': '√áizgili ≈üeker olu≈üturuldu!',
                            'wrapped_candy_created': 'Paketlenmi≈ü ≈üeker olu≈üturuldu!',
                            'fish_created': 'Balƒ±k olu≈üturuldu!',
                            'coconut_created': 'Hindistan cevizi olu≈üturuldu!',
                            'board_shuffled': 'Tahta karƒ±≈ütƒ±rƒ±ldƒ±',
                            'watching_ad': 'Reklam izleniyor...',
                            'ad_title': 'Mix Crush Reklamƒ±',
                            'ad_text': 'ƒ∞zlediƒüiniz i√ßin te≈üekk√ºrler! Booster kazandƒ±nƒ±z.',
                            'ad_closing': 'Bu pencere otomatik kapanacak...',
                            'out_of_stock': 'Stokta yok'
                        }
                    }
                };
                
                this.currentLang = 'en';
                this.init();
            }
            
            init() {
                const savedLang = localStorage.getItem('mix_crush_lang');
                if (savedLang && this.languages[savedLang]) {
                    this.currentLang = savedLang;
                } else {
                    this.currentLang = 'en';
                    localStorage.setItem('mix_crush_lang', 'en');
                }
                
                this.applyLanguage();
                this.initLanguageSelector();
            }
            
            initLanguageSelector() {
                const dropdown = document.getElementById('lang-dropdown');
                if (!dropdown) return;
                
                dropdown.innerHTML = '';
                
                Object.values(this.languages).forEach(lang => {
                    const option = document.createElement('div');
                    option.className = 'lang-option';
                    if (lang.code === this.currentLang) {
                        option.classList.add('active');
                    }
                    
                    option.innerHTML = `
                        <span class="lang-flag">${lang.flag}</span>
                        <span class="lang-name">${lang.name}</span>
                    `;
                    
                    option.onclick = () => {
                        this.setLanguage(lang.code);
                        dropdown.classList.remove('show');
                    };
                    
                    dropdown.appendChild(option);
                });
                
                const langBtn = document.getElementById('lang-btn');
                if (langBtn) {
                    langBtn.onclick = (e) => {
                        e.stopPropagation();
                        dropdown.classList.toggle('show');
                    };
                }
                
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.lang-selector')) {
                        dropdown.classList.remove('show');
                    }
                });
            }
            
            setLanguage(langCode) {
                if (this.languages[langCode]) {
                    this.currentLang = langCode;
                    localStorage.setItem('mix_crush_lang', langCode);
                    this.applyLanguage();
                    
                    const lang = this.languages[langCode];
                    document.body.style.direction = lang.direction;
                    document.documentElement.lang = langCode;
                    
                    const currentLangFlag = document.getElementById('current-lang-flag');
                    const currentLangName = document.getElementById('current-lang-name');
                    if (currentLangFlag && currentLangName) {
                        currentLangFlag.textContent = lang.flag;
                        currentLangName.textContent = lang.name;
                    }
                    
                    if (window.game) {
                        window.game.showToast(this.translate('language_changed'));
                    }
                }
            }
            
            applyLanguage() {
                const lang = this.languages[this.currentLang];
                
                const currentLangFlag = document.getElementById('current-lang-flag');
                const currentLangName = document.getElementById('current-lang-name');
                if (currentLangFlag && currentLangName) {
                    currentLangFlag.textContent = lang.flag;
                    currentLangName.textContent = lang.name;
                }
                
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    const translation = this.translate(key, this.currentLang);
                    if (translation) {
                        if (el.tagName === 'INPUT' && el.type === 'range') {
                            return;
                        }
                        el.textContent = translation;
                    }
                });
                
                document.querySelectorAll('[data-i18n-title]').forEach(el => {
                    const key = el.getAttribute('data-i18n-title');
                    const translation = this.translate(key, this.currentLang);
                    if (translation) {
                        el.title = translation;
                    }
                });
                
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    const translation = this.translate(key, this.currentLang);
                    if (translation) {
                        el.placeholder = translation;
                    }
                });
            }
            
            translate(key, langCode = null) {
                const lang = langCode || this.currentLang;
                const translation = this.languages[lang]?.translations[key];
                
                if (!translation && lang !== 'en') {
                    return this.languages['en']?.translations[key] || key;
                }
                
                return translation || key;
            }
            
            format(key, ...args) {
                let translation = this.translate(key);
                args.forEach((arg, index) => {
                    translation = translation.replace(`{${index}}`, arg);
                });
                return translation;
            }
        }

        // === STORAGE MANAGER ===
        class StorageManager {
            constructor() {
                this.prefix = 'mix_crush_pro_levels_';
                this.data = {
                    settings: { 
                        sfx: 70, 
                        music: 50, 
                        effects: true, 
                        darkMode: false, 
                        shape: 'candy' 
                    },
                    stats: { 
                        totalGames: 0, 
                        totalScore: 0, 
                        totalTime: 0, 
                        bestCombo: 0,
                        bestScore: 0,
                        specialCandiesCreated: 0,
                        totalMatches: 0,
                        levelTimes: {},
                        levelStars: {},
                        completedLevels: 0
                    },
                    progress: { 
                        currentLevel: 1, 
                        unlockedLevels: 1,
                        boosters: { hammer: 3, bomb: 2, shuffle: 1, fish: 2, coconut: 1 }
                    }
                };
                this.load();
            }
            
            load() {
                Object.keys(this.data).forEach(key => {
                    const saved = localStorage.getItem(this.prefix + key);
                    if (saved) {
                        try { 
                            this.data[key] = JSON.parse(saved); 
                        } catch(e) {
                            console.warn('Failed to load', key, e);
                        }
                    }
                });
            }
            
            save(key) { 
                localStorage.setItem(this.prefix + key, JSON.stringify(this.data[key])); 
            }
            
            get(key) { 
                return this.data[key]; 
            }
            
            set(key, value) { 
                this.data[key] = value; 
                this.save(key); 
            }
            
            update(key, updates) {
                this.data[key] = { ...this.data[key], ...updates };
                this.save(key);
            }
            
            reset() { 
                localStorage.clear(); 
                location.reload();
            }
        }

        // === AUDIO MANAGER ===
        class AudioManager {
            constructor(storage) {
                this.storage = storage;
                this.audioContext = null;
                this.sounds = {};
                this.isMuted = false;
                this.soundFiles = {
                    match: 'sounds/match.mp3',
                    swap: 'sounds/swap.mp3',
                    click: 'sounds/click.mp3',
                    error: 'sounds/error.mp3',
                    win: 'sounds/win.mp3',
                    lose: 'sounds/lose.mp3',
                    special: 'sounds/special.mp3',
                    combo: 'sounds/combo.mp3',
                    boom: 'sounds/boom.mp3',
                    background: 'sounds/background.mp3'
                };
                this.init();
            }
            
            async init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    await this.preloadSounds();
                } catch (e) {
                    console.warn('Web Audio API not supported, falling back to HTML5 Audio:', e);
                    this.useHTML5Audio = true;
                }
            }
            
            async preloadSounds() {
                if (this.useHTML5Audio) return;
                
                const basicSounds = ['match', 'swap', 'click', 'error'];
                
                for (const soundName of basicSounds) {
                    await this.loadSound(soundName);
                }
            }
            
            async loadSound(soundName) {
                try {
                    const response = await fetch(this.soundFiles[soundName]);
                    const arrayBuffer = await response.arrayBuffer();
                    const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);
                    this.sounds[soundName] = audioBuffer;
                } catch (e) {
                    console.warn(`Failed to load sound ${soundName}:`, e);
                    this.useHTML5Audio = true;
                }
            }
            
            playSound(type) {
                if (this.isMuted || !this.storage.get('settings').effects) return;
                
                const volume = this.storage.get('settings').sfx / 100 * 0.7;
                
                if (this.useHTML5Audio || !this.sounds[type]) {
                    this.playHTML5Sound(type, volume);
                } else {
                    this.playBufferSound(type, volume);
                }
            }
            
            playHTML5Sound(type, volume) {
                try {
                    const audio = new Audio();
                    audio.volume = volume;
                    const soundFile = this.soundFiles[type];
                    if (soundFile) {
                        audio.src = soundFile;
                        audio.play().catch(e => console.warn(`Audio play failed: ${e}`));
                    } else {
                        this.createFallbackSound(type, volume);
                    }
                } catch (e) {
                    console.warn('HTML5 Audio failed, using fallback:', e);
                    this.createFallbackSound(type, volume);
                }
            }
            
            playBufferSound(type, volume) {
                if (!this.sounds[type]) {
                    this.createFallbackSound(type, volume);
                    return;
                }
                
                try {
                    const source = this.audioContext.createBufferSource();
                    const gainNode = this.audioContext.createGain();
                    
                    source.buffer = this.sounds[type];
                    source.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    gainNode.gain.value = volume;
                    source.start(0);
                } catch (e) {
                    console.warn('Buffer sound play failed:', e);
                    this.playHTML5Sound(type, volume);
                }
            }
            
            createFallbackSound(type, volume) {
                try {
                    if (!this.audioContext) return;
                    
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    const frequencies = {
                        'match': 800,
                        'swap': 600,
                        'click': 1000,
                        'error': 300,
                        'win': [523.25, 659.25, 783.99],
                        'lose': [261.63, 220, 196],
                        'special': 1200,
                        'combo': [1000, 1200, 1400],
                        'boom': 150
                    };
                    
                    const freq = frequencies[type] || 800;
                    
                    if (Array.isArray(freq)) {
                        const now = this.audioContext.currentTime;
                        freq.forEach((f, i) => {
                            oscillator.frequency.setValueAtTime(f, now + i * 0.1);
                        });
                    } else {
                        oscillator.frequency.setValueAtTime(freq, this.audioContext.currentTime);
                    }
                    
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(volume, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + 0.3);
                } catch (e) {
                    console.warn('Fallback sound failed:', e);
                }
            }
            
            setVolume(type, value) {
                const settings = this.storage.get('settings');
                settings[type] = value;
                this.storage.set('settings', settings);
            }
        }

        // === PARTICLE SYSTEM ===
        class ParticleSystem {
            constructor(storage) {
                this.storage = storage;
                this.enabled = true;
            }
            
            createBurst(x, y, type = 'match') {
                if (!this.enabled || !this.storage.get('settings').effects) return;
                
                const particleCount = type === 'special' ? 15 : type === 'boom' ? 20 : 8;
                const colors = type === 'special' ? 
                    ['#FFD700', '#FF69B4', '#00CED1', '#32CD32', '#FF6347', '#9370DB', '#00BFFF'] :
                    ['#FFD700', '#FF69B4', '#00CED1', '#32CD32', '#FF6347'];
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    const size = Math.random() * 8 + 4;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    particle.style.cssText = `
                        position: fixed;
                        width: ${size}px;
                        height: ${size}px;
                        background: ${color};
                        border-radius: 50%;
                        left: ${x}px;
                        top: ${y}px;
                        pointer-events: none;
                        z-index: 1000;
                        transform: scale(0);
                    `;
                    
                    document.body.appendChild(particle);
                    
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = Math.random() * 3 + 2;
                    const distance = velocity * 60;
                    
                    const animation = particle.animate([
                        { 
                            transform: 'scale(0) translate(0, 0)', 
                            opacity: 1 
                        },
                        { 
                            transform: 'scale(1) translate(0, 0)', 
                            opacity: 1 
                        },
                        { 
                            transform: `scale(0) translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance - 40}px)`, 
                            opacity: 0 
                        }
                    ], {
                        duration: 1000,
                        easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
                    });
                    
                    animation.onfinish = () => particle.remove();
                }
            }
        }

        // === BOOSTER MANAGER ===
        class BoosterManager {
            constructor(game, storage, language) {
                this.game = game;
                this.storage = storage;
                this.language = language;
                this.types = {
                    hammer: { count: 3, icon: 'üî®', name: 'Hammer', desc: 'hammer_desc' },
                    bomb: { count: 2, icon: 'üí£', name: 'Bomb', desc: 'bomb_desc' },
                    shuffle: { count: 1, icon: 'üîÄ', name: 'Shuffle', desc: 'shuffle_desc' },
                    fish: { count: 2, icon: 'üêü', name: 'Fish', desc: 'fish_desc' },
                    coconut: { count: 1, icon: 'ü••', name: 'Coconut', desc: 'coconut_desc' }
                };
                this.load();
            }
            
            load() {
                const saved = this.storage.get('progress').boosters;
                Object.keys(this.types).forEach(key => {
                    if (saved[key] !== undefined) {
                        this.types[key].count = saved[key];
                    }
                });
            }
            
            save() {
                const data = {};
                Object.keys(this.types).forEach(key => data[key] = this.types[key].count);
                this.storage.update('progress', { boosters: data });
            }
            
            use(type) {
                const booster = this.types[type];
                if (!booster || booster.count <= 0) {
                    return false;
                }
                
                booster.count--;
                this.save();
                this.updateUI();
                return true;
            }
            
            addByAd(type) {
                const booster = this.types[type];
                if (booster) {
                    booster.count += 1;
                    this.save();
                    this.updateUI();
                }
            }
            
            activate(candy, type) {
                if (!type) return;
                
                this.game.audio.playSound('boom');
                
                switch (type) {
                    case 'hammer':
                        this.game.processMatches([candy]);
                        break;
                    case 'bomb':
                        const matches = [];
                        for (let r = Math.max(0, candy.row - 1); r <= Math.min(7, candy.row + 1); r++) {
                            for (let c = Math.max(0, candy.col - 1); c <= Math.min(7, candy.col + 1); c++) {
                                if (this.game.board[r][c]) {
                                    matches.push(this.game.board[r][c]);
                                }
                            }
                        }
                        this.game.processSpecialMatches(matches, 200);
                        break;
                    case 'shuffle':
                        this.game.createBoard();
                        this.game.render();
                        this.game.showGameNotification(`üîÄ ${this.language.translate('board_shuffled')}!`);
                        break;
                    case 'fish':
                        const fishMatches = this.game.getRandomCandies(3);
                        this.game.processSpecialMatches(fishMatches, 150);
                        break;
                    case 'coconut':
                        const coconutMatches = this.game.getColumnCandies(candy.col);
                        this.game.processSpecialMatches(coconutMatches, 250);
                        break;
                }
                
                if (candy && candy.element) {
                    this.game.particles.createBurst(
                        candy.element.offsetLeft + candy.element.offsetWidth / 2,
                        candy.element.offsetTop + candy.element.offsetHeight / 2,
                        'boom'
                    );
                }
            }
            
            updateUI() {
                document.getElementById('hammer-count').textContent = this.types.hammer.count;
                document.getElementById('bomb-count').textContent = this.types.bomb.count;
                document.getElementById('shuffle-count').textContent = this.types.shuffle.count;
                document.getElementById('fish-count').textContent = this.types.fish.count;
                document.getElementById('coconut-count').textContent = this.types.coconut.count;
                
                document.querySelectorAll('.booster-btn').forEach(btn => {
                    const type = btn.dataset.booster;
                    const count = this.types[type].count;
                    
                    btn.classList.remove('disabled', 'out-of-stock');
                    
                    const existingAdd = btn.querySelector('.add-plus');
                    if (existingAdd) {
                        existingAdd.remove();
                    }
                    
                    if (count === 0) {
                        btn.classList.add('out-of-stock');
                        
                        const addPlus = document.createElement('div');
                        addPlus.className = 'add-plus';
                        addPlus.textContent = 'add+';
                        btn.appendChild(addPlus);
                        
                        btn.title = `${this.language.translate(this.types[type].desc)} (${this.language.translate('out_of_stock')} - ${this.language.translate('watch_ad')}!)`;
                    } else {
                        btn.classList.toggle('disabled', false);
                        btn.title = this.language.translate(this.types[type].desc);
                    }
                });
            }
        }

        // === OYUN SINIFI ===
        class MixCrushGame {
            constructor() {
                this.size = 8;
                this.board = [];
                this.score = 0;
                this.moves = 30;
                this.target = 10000;
                this.level = 1;
                this.selected = null;
                this.isBusy = false;
                this.combo = 0;
                this.maxCombo = 0;
                this.stats = { 
                    matches: 0, 
                    specials: 0, 
                    time: 0, 
                    colorMatches: {},
                    currentStreak: 0,
                    maxStreak: 0,
                    specialsCreated: 0,
                    specialsUsed: 0
                };
                this.gameTime = 0;
                this.timeInterval = null;
                this.timeBonusActive = false;
                this.currentBooster = null;
                this.isTimerPaused = false;
                this.adWindow = null;
                this.adTimer = null;
                this.adCountdown = 5;
                this.lastNotificationTime = 0;
                this.fromLevelsScreen = false;
                
                this.language = new LanguageManager();
                this.storage = new StorageManager();
                this.audio = new AudioManager(this.storage);
                this.particles = new ParticleSystem(this.storage);
                this.boosters = new BoosterManager(this, this.storage, this.language);
                
                this.initThemes();
                this.initLevels();
                this.bindEvents();
                this.applySettings();
                this.updateLevelsGrid();
                
                window.addEventListener('resize', () => this.adjustBoardSize());
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.adjustBoardSize(), 100);
                });
                
                document.addEventListener('languageChanged', () => {
                    this.updateAllTexts();
                });
            }

            // === D√úZELTƒ∞LMƒ∞≈û REKLAM Sƒ∞STEMƒ∞ ===
            showAdModal(boosterType) {
                this.requestedBooster = boosterType;
                
                // Ad modalƒ±nƒ± g√∂ster
                const adModal = document.getElementById('ad-modal');
                
                // Ba≈ülƒ±k ve mesajlarƒ± g√ºncelle
                const titleEl = document.getElementById('ad-title');
                const messageEl = document.getElementById('ad-message');
                
                if (titleEl) {
                    titleEl.textContent = this.language.translate('get_booster');
                }
                if (messageEl) {
                    messageEl.textContent = this.language.translate('watch_ad_for_booster');
                }
                
                // Geri sayƒ±mƒ± sƒ±fƒ±rla
                this.adCountdown = 5;
                const countdownEl = document.getElementById('ad-countdown');
                if (countdownEl) {
                    countdownEl.textContent = this.adCountdown;
                }
                
                adModal.classList.add('active');
                this.pauseTimer();
            }

            hideAdModal() {
                const adModal = document.getElementById('ad-modal');
                adModal.classList.remove('active');
                this.resumeTimer();
                
                // Timer'ƒ± temizle
                if (this.adTimer) {
                    clearInterval(this.adTimer);
                    this.adTimer = null;
                }
            }

            watchAd() {
                // Reklam izleme sim√ºlasyonu - aynƒ± pencerede modal
                this.showToast(this.language.translate('watching_ad'));
                
                // Watch Ad butonunu devre dƒ±≈üƒ± bƒ±rak
                const watchBtn = document.getElementById('watch-ad-btn');
                watchBtn.disabled = true;
                watchBtn.style.opacity = '0.5';
                
                // Cancel butonunu g√ºncelle
                const cancelBtn = document.getElementById('cancel-ad-btn');
                cancelBtn.textContent = this.language.translate('close');
                
                // Geri sayƒ±mƒ± ba≈ülat
                this.adCountdown = 5;
                const countdownEl = document.getElementById('ad-countdown');
                countdownEl.textContent = this.adCountdown;
                
                // Geri sayƒ±m timer'ƒ±
                this.adTimer = setInterval(() => {
                    this.adCountdown--;
                    countdownEl.textContent = this.adCountdown;
                    
                    if (this.adCountdown <= 0) {
                        clearInterval(this.adTimer);
                        this.adTimer = null;
                        
                        // Reklam tamamlandƒ±, booster ekle
                        this.addBoosterByAd();
                        
                        // Modal'ƒ± kapat
                        setTimeout(() => {
                            this.hideAdModal();
                            
                            // Watch Ad butonunu tekrar etkinle≈ütir
                            watchBtn.disabled = false;
                            watchBtn.style.opacity = '1';
                            cancelBtn.textContent = this.language.translate('cancel');
                        }, 500);
                    }
                }, 1000);
            }

            cancelAd() {
                this.hideAdModal();
                this.showToast(this.language.translate('ad_cancelled'));
                this.requestedBooster = null;
                
                // Watch Ad butonunu tekrar etkinle≈ütir
                const watchBtn = document.getElementById('watch-ad-btn');
                watchBtn.disabled = false;
                watchBtn.style.opacity = '1';
                
                // Cancel butonunu eski haline getir
                const cancelBtn = document.getElementById('cancel-ad-btn');
                cancelBtn.textContent = this.language.translate('cancel');
            }

            addBoosterByAd() {
                if (this.requestedBooster) {
                    this.boosters.addByAd(this.requestedBooster);
                    this.showToast(this.language.format('booster_added', this.boosters.types[this.requestedBooster].name));
                    
                    this.requestedBooster = null;
                }
            }

            showBoosterInfo(type) {
                const messages = {
                    'hammer': this.language.translate('hammer_info'),
                    'bomb': this.language.translate('bomb_info'),
                    'shuffle': this.language.translate('shuffle_info'),
                    'fish': this.language.translate('fish_info'),
                    'coconut': this.language.translate('coconut_info')
                };
                
                const info = document.getElementById('booster-info');
                info.textContent = messages[type];
                info.classList.remove('show');
                
                setTimeout(() => {
                    info.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    info.classList.remove('show');
                }, 2000);
            }

            useBooster(type) {
                if (this.currentBooster === type) {
                    this.cancelBooster();
                    return;
                }
                
                const canUse = this.boosters.use(type);
                if (canUse) {
                    this.currentBooster = type;
                    this.showGameNotification(this.language.translate('booster_active'));
                    this.audio.playSound('special');
                }
            }

            useActiveBooster(candy) {
                if (!this.currentBooster || this.isBusy) return;
                
                this.boosters.activate(candy, this.currentBooster);
                this.currentBooster = null;
                
                this.moves--;
                
                this.updateUI();
                this.checkWin();
            }

            cancelBooster() {
                this.currentBooster = null;
                this.showGameNotification(this.language.translate('booster_cancelled'));
            }

            // === OYUNUN DEVAMI ===
            initThemes() {
                this.themes = {
                    candy: { 
                        emojis: ['üç¨', 'üç≠', 'üç´', 'üßÅ', 'üç™', 'üç©'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    },
                    sports: { 
                        emojis: ['‚öΩ', 'üèÄ', 'üéæ', 'üèê', 'üèâ', 'ü•é'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    },
                    planets: { 
                        emojis: ['ü™ê', 'üåë', 'üåö', 'üåï', 'üåù', '‚òÑÔ∏è'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    },
                    balloons: { 
                        emojis: ['üéà', 'üéä', 'üéâ', 'üéÅ', 'üéÄ', 'üéóÔ∏è'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    },
                    letters: { 
                        emojis: ['A', 'B', 'C', 'D', 'E', 'F'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    },
                    numbers: { 
                        emojis: ['1', '2', '3', '4', '5', '6'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    },
                    fruits: { 
                        emojis: ['üçé', 'üçå', 'üçá', 'üçì', 'üçâ', 'üçä'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    },
                    animals: { 
                        emojis: ['üê±', 'üê∂', 'üê∞', 'üêØ', 'üê®', 'üêº'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    },
                    hearts: { 
                        emojis: ['üíñ', 'üíô', 'üíö', 'üíõ', 'üíú', 'üß°'], 
                        colors: ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF5252', '#36D1DC', '#5B86E5'] 
                    }
                };
                
                const savedShape = this.storage.get('settings').shape || 'candy';
                this.currentShape = savedShape;
                this.activeTheme = this.themes[savedShape] || this.themes.candy;
                
                document.querySelectorAll('.shape-btn').forEach(btn => {
                    if (btn.dataset.shape === savedShape) {
                        btn.classList.add('active');
                    }
                });
            }

            initLevels() {
                this.levels = [];
                for (let i = 1; i <= 100; i++) {
                    const baseTarget = 10000;
                    const target = baseTarget * (1 + (i - 1) * 0.2);
                    const moves = Math.max(15, 35 - Math.floor(i / 5));
                    
                    this.levels.push({
                        id: i,
                        target: Math.round(target),
                        moves: moves,
                        difficulty: i <= 20 ? 'Easy' : i <= 50 ? 'Medium' : i <= 80 ? 'Hard' : 'Very Hard',
                        stars: 0,
                        completed: false,
                        bestTime: null,
                        bestScore: 0
                    });
                }
            }

            bindEvents() {
                // Ana men√º butonlarƒ±
                document.getElementById('start-btn').onclick = () => this.showShapeSelection();
                document.getElementById('levels-btn').onclick = () => this.showLevelsScreen();
                document.getElementById('stats-btn').onclick = () => this.showStats();
                document.getElementById('settings-btn').onclick = () => this.showSettings();
                
                // ≈ûekil se√ßim
                document.getElementById('back-from-shape').onclick = () => this.showScreen('start-screen');
                document.getElementById('shape-confirm').onclick = () => this.startGameFromShape();
                document.querySelectorAll('.shape-btn').forEach(btn => {
                    btn.onclick = () => {
                        document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentShape = btn.dataset.shape;
                    };
                });
                
                // Seviyeler ekranƒ±
                document.getElementById('back-from-levels').onclick = () => this.showScreen('start-screen');
                
                // Oyun ekranƒ±
                document.getElementById('home-btn').onclick = () => this.showConfirm(
                    this.language.translate('exit_game'),
                    this.language.translate('exit_confirm'),
                    () => this.showScreen('start-screen')
                );
                document.getElementById('game-settings-btn').onclick = () => this.showSettings();
                
                // Ayarlar modalƒ±
                document.getElementById('close-settings').onclick = () => this.hideModal('settings-modal');
                document.getElementById('close-settings-btn').onclick = () => this.hideModal('settings-modal');
                document.getElementById('reset-btn').onclick = () => {
                    this.showConfirm(
                        this.language.translate('reset_data'),
                        this.language.translate('reset_confirm'),
                        () => this.storage.reset()
                    );
                };
                
                // ƒ∞statistikler modalƒ±
                document.getElementById('close-stats').onclick = () => this.hideModal('stats-modal');
                
                // Oyun bitti modalƒ±
                document.getElementById('next-level-btn').onclick = () => this.nextLevel();
                document.getElementById('restart-level-btn').onclick = () => this.restartLevel();
                document.getElementById('back-to-levels-btn').onclick = () => {
                    this.hideModal('game-over-modal');
                    this.showLevelsScreen();
                };
                document.getElementById('back-to-menu-btn').onclick = () => {
                    this.hideModal('game-over-modal');
                    this.showScreen('start-screen');
                };
                
                // Onay modalƒ±
                document.getElementById('confirm-yes').onclick = () => this.confirmYes();
                document.getElementById('confirm-no').onclick = () => this.hideConfirm();
                
                // Reklam modalƒ± (D√úZELTƒ∞LDƒ∞)
                document.getElementById('watch-ad-btn').onclick = () => this.watchAd();
                document.getElementById('cancel-ad-btn').onclick = () => this.cancelAd();
                
                // Ayarlar kontrolleri
                document.getElementById('sfx-volume').oninput = (e) => {
                    const value = e.target.value;
                    document.getElementById('sfx-value').textContent = `${value}%`;
                    this.audio.setVolume('sfx', parseInt(value));
                };
                
                document.getElementById('music-volume').oninput = (e) => {
                    const value = e.target.value;
                    document.getElementById('music-value').textContent = `${value}%`;
                    this.audio.setVolume('music', parseInt(value));
                };
                
                document.getElementById('effects-toggle').onchange = (e) => {
                    this.storage.update('settings', { effects: e.target.checked });
                    this.particles.enabled = e.target.checked;
                };
                
                document.getElementById('dark-mode-toggle').onchange = (e) => {
                    this.storage.update('settings', { darkMode: e.target.checked });
                    this.applySettings();
                };
                
                // Booster butonlarƒ±
                document.querySelectorAll('.booster-btn').forEach(btn => {
                    btn.onclick = (e) => {
                        e.stopPropagation();
                        const type = btn.dataset.booster;
                        this.showBoosterInfo(type);
                        
                        if (btn.classList.contains('out-of-stock')) {
                            setTimeout(() => {
                                this.showAdModal(type);
                            }, 500);
                        } else {
                            this.useBooster(type);
                        }
                    };
                });
                
                this.setupTouchEvents();
            }

            setupTouchEvents() {
                let touchStartX, touchStartY;
                const gameBoard = document.getElementById('game-board');
                
                gameBoard.addEventListener('touchstart', (e) => {
                    if (this.isBusy) return;
                    e.preventDefault();
                    const touch = e.touches[0];
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;
                }, { passive: false });
                
                gameBoard.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    const touch = e.changedTouches[0];
                    const deltaX = touch.clientX - touchStartX;
                    const deltaY = touch.clientY - touchStartY;
                    
                    if (Math.abs(deltaX) < 10 && Math.abs(deltaY) < 10) {
                        const element = document.elementFromPoint(touch.clientX, touch.clientY);
                        if (element && element.classList.contains('candy')) {
                            const row = +element.dataset.row;
                            const col = +element.dataset.col;
                            if (!isNaN(row) && !isNaN(col)) {
                                this.clickCandy(this.board[row][col]);
                            }
                        }
                    }
                }, { passive: false });
            }

            showScreen(id) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(id).classList.add('active');
                
                if (id === 'game-screen') {
                    setTimeout(() => {
                        this.adjustBoardSize();
                    }, 100);
                }
                
                if (id === 'stats-modal') {
                    this.updateStats();
                }
                
                if (id === 'levels-screen') {
                    this.updateLevelsGrid();
                }
            }

            showShapeSelection() {
                this.showScreen('shape-screen');
            }

            showLevelsScreen() {
                this.showScreen('levels-screen');
            }

            showSettings() {
                this.applySettings();
                this.showModal('settings-modal');
            }

            showStats() {
                this.updateStats();
                this.showModal('stats-modal');
            }

            showModal(id) {
                document.getElementById(id).classList.add('active');
                this.pauseTimer();
            }

            hideModal(id) {
                document.getElementById(id).classList.remove('active');
                this.resumeTimer();
            }

            showConfirm(title, message, yesCallback) {
                document.getElementById('confirm-title').textContent = title;
                document.getElementById('confirm-message').textContent = message;
                this.confirmCallback = yesCallback;
                document.getElementById('confirm-modal').classList.add('active');
            }

            hideConfirm() {
                document.getElementById('confirm-modal').classList.remove('active');
                this.confirmCallback = null;
            }

            confirmYes() {
                if (this.confirmCallback) {
                    this.confirmCallback();
                }
                this.hideConfirm();
            }

            updateAllTexts() {
                this.language.applyLanguage();
                
                if (document.getElementById('game-screen').classList.contains('active')) {
                    this.updateGameTexts();
                }
                
                this.updateLevelsGrid();
            }

            updateGameTexts() {
                document.getElementById('mode-indicator').textContent = 
                    this.language.format('level_x', this.level);
            }

            startGameFromShape() {
                this.storage.update('settings', { shape: this.currentShape });
                this.activeTheme = this.themes[this.currentShape] || this.themes.candy;
                
                const progress = this.storage.get('progress');
                this.level = progress.currentLevel || 1;
                
                this.loadLevel(this.level);
                this.showScreen('game-screen');
            }

            startGameFromLevels(level) {
                this.level = level;
                this.loadLevel(level);
                this.showScreen('game-screen');
            }

            updateLevelsGrid() {
                const grid = document.getElementById('levels-grid');
                if (!grid) return;
                
                const progress = this.storage.get('progress');
                const stats = this.storage.get('stats');
                const levelTimes = stats.levelTimes || {};
                const levelStars = stats.levelStars || {};
                
                grid.innerHTML = '';
                
                const unlockedLevels = progress.unlockedLevels || 1;
                const openLevelsEl = document.getElementById('open-levels');
                if (openLevelsEl) {
                    openLevelsEl.textContent = unlockedLevels;
                }
                
                const levelsInfo = document.getElementById('levels-info');
                if (levelsInfo) {
                    levelsInfo.innerHTML = `
                        <span data-i18n="open_levels">${this.language.translate('open_levels')}:</span> 
                        <span id="open-levels">${unlockedLevels}</span>/100
                    `;
                }
                
                for (let i = 1; i <= 100; i++) {
                    const levelBtn = document.createElement('button');
                    levelBtn.className = 'level-btn';
                    
                    if (i <= unlockedLevels) {
                        levelBtn.onclick = () => this.startGameFromLevels(i);
                        
                        const levelTime = levelTimes[i];
                        const stars = levelStars[i] || 0;
                        
                        if (levelTime) {
                            levelBtn.classList.add('completed');
                            const min = Math.floor(levelTime / 60);
                            const sec = (levelTime % 60).toString().padStart(2, '0');
                            
                            levelBtn.innerHTML = `
                                <div class="level-number">${i}</div>
                                <div class="level-time">${min}:${sec}</div>
                                ${stars > 0 ? `<div class="level-stars">${'‚≠ê'.repeat(stars)}</div>` : ''}
                            `;
                        } else {
                            levelBtn.innerHTML = `<div class="level-number">${i}</div>`;
                        }
                    } else {
                        levelBtn.classList.add('locked');
                        levelBtn.innerHTML = `
                            <div class="level-number">${i}</div>
                            <div style="font-size:10px; margin-top:4px;">üîí</div>
                        `;
                    }
                    
                    grid.appendChild(levelBtn);
                }
            }

            loadLevel(levelNum) {
                const level = this.levels[levelNum - 1] || this.levels[0];
                
                this.level = level.id;
                this.target = level.target;
                this.moves = level.moves;
                this.score = 0;
                this.combo = 0;
                this.maxCombo = 0;
                this.gameTime = 0;
                this.timeBonusActive = false;
                this.currentBooster = null;
                this.stats = { 
                    matches: 0, 
                    specials: 0, 
                    time: 0, 
                    colorMatches: {},
                    currentStreak: 0,
                    maxStreak: 0,
                    specialsCreated: 0,
                    specialsUsed: 0
                };
                
                if (this.timeInterval) {
                    clearInterval(this.timeInterval);
                    this.timeInterval = null;
                }
                
                this.checkAndRefillBoosters();
                
                document.getElementById('mode-indicator').textContent = 
                    this.language.format('level_x', this.level);
                
                this.startTimer();
                this.createBoard();
                this.render();
                this.bindGameBoard();
                this.updateUI();
                this.boosters.updateUI();
                
                this.showToast(this.language.format('level_start', this.level));
            }

            checkAndRefillBoosters() {
                const maxCounts = {
                    hammer: 3,
                    bomb: 2,
                    shuffle: 1,
                    fish: 2,
                    coconut: 1
                };
                
                Object.keys(this.boosters.types).forEach(key => {
                    const booster = this.boosters.types[key];
                    const maxCount = maxCounts[key];
                    
                    if (booster.count < maxCount) {
                        booster.count += 1;
                    }
                });
                
                this.boosters.save();
            }

            startTimer() {
                this.gameTime = 0;
                this.updateTimeDisplay();
                this.isTimerPaused = false;
                
                if (this.timeInterval) {
                    clearInterval(this.timeInterval);
                }
                
                this.timeInterval = setInterval(() => {
                    if (!this.isTimerPaused) {
                        this.gameTime++;
                        this.updateTimeDisplay();
                    }
                }, 1000);
            }

            pauseTimer() {
                this.isTimerPaused = true;
            }

            resumeTimer() {
                this.isTimerPaused = false;
            }

            updateTimeDisplay() {
                const minutes = Math.floor(this.gameTime / 60);
                const seconds = this.gameTime % 60;
                document.getElementById('time-display').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            createBoard() {
                this.board = [];
                for (let row = 0; row < this.size; row++) {
                    this.board[row] = [];
                    for (let col = 0; col < this.size; col++) {
                        let candy;
                        do {
                            candy = this.createCandy(row, col);
                        } while (this.checkInitialMatch(candy, row, col));
                        this.board[row][col] = candy;
                    }
                }
                
                while (this.findMatches().length > 0) {
                    this.createBoard();
                }
            }

            createCandy(row, col) {
                const typeIndex = Math.floor(Math.random() * this.activeTheme.emojis.length);
                return {
                    type: this.activeTheme.emojis[typeIndex],
                    color: this.activeTheme.colors[typeIndex],
                    colorIndex: typeIndex,
                    row, col,
                    element: null,
                    special: null,
                    isSpecial: false
                };
            }

            checkInitialMatch(candy, row, col) {
                if (col >= 2 && this.board[row][col - 1]?.type === candy.type && this.board[row][col - 2]?.type === candy.type) return true;
                if (row >= 2 && this.board[row - 1][col]?.type === candy.type && this.board[row - 2][col]?.type === candy.type) return true;
                return false;
            }

            render() {
                const board = document.getElementById('game-board');
                if (!board) return;
                
                board.innerHTML = '';
                
                for (let row = 0; row < this.size; row++) {
                    for (let col = 0; col < this.size; col++) {
                        const candy = this.board[row][col];
                        const div = document.createElement('div');
                        div.className = 'candy';
                        div.style.backgroundColor = candy.color;
                        div.textContent = candy.type;
                        div.dataset.row = row;
                        div.dataset.col = col;
                        
                        const fontSize = Math.min(28, this.calculateCandySize() * 0.5);
                        div.style.fontSize = `${fontSize}px`;
                        
                        if (candy.special) {
                            this.applySpecialEffects(div, candy.special);
                            div.classList.add(`special-${candy.special}`);
                        }
                        
                        candy.element = div;
                        board.appendChild(div);
                    }
                }
            }

            applySpecialEffects(element, specialType) {
                element.classList.add('candy');
                
                switch(specialType) {
                    case 'striped':
                        element.classList.add('special-striped');
                        element.textContent = 'üéá';
                        break;
                    case 'wrapped':
                        element.classList.add('special-wrapped');
                        element.textContent = 'üéÅ';
                        break;
                    case 'color-bomb':
                        element.classList.add('special-color-bomb');
                        element.textContent = 'üí£';
                        break;
                    case 'fish':
                        element.classList.add('special-fish');
                        element.textContent = 'üêü';
                        break;
                    case 'coconut':
                        element.classList.add('special-coconut');
                        element.textContent = 'ü••';
                        break;
                }
            }

            bindGameBoard() {
                const board = document.getElementById('game-board');
                if (!board) return;
                
                board.onclick = (e) => {
                    if (this.currentBooster) {
                        if (e.target.classList.contains('candy')) {
                            const row = +e.target.dataset.row;
                            const col = +e.target.dataset.col;
                            if (!isNaN(row) && !isNaN(col)) {
                                this.useActiveBooster(this.board[row][col]);
                            }
                        }
                        return;
                    }
                    
                    if (!e.target.classList.contains('candy')) return;
                    
                    const row = +e.target.dataset.row;
                    const col = +e.target.dataset.col;
                    
                    if (isNaN(row) || isNaN(col) || this.isBusy || this.moves <= 0) return;
                    
                    this.clickCandy(this.board[row][col]);
                };
            }

            clickCandy(candy) {
                this.audio.playSound('click');
                
                if (!this.selected) {
                    this.select(candy);
                } else if (this.selected === candy) {
                    this.deselect();
                } else {
                    if (this.areNeighbors(this.selected, candy)) {
                        this.swapCandies(this.selected, candy);
                    } else {
                        this.deselect();
                        this.select(candy);
                    }
                }
            }

            select(candy) {
                this.selected = candy;
                if (candy.element) {
                    candy.element.classList.add('selected');
                }
            }

            deselect() {
                if (this.selected && this.selected.element) {
                    this.selected.element.classList.remove('selected');
                }
                this.selected = null;
            }

            areNeighbors(candy1, candy2) {
                const rowDiff = Math.abs(candy1.row - candy2.row);
                const colDiff = Math.abs(candy1.col - candy2.col);
                return (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1);
            }

            async swapCandies(candy1, candy2) {
                this.isBusy = true;
                
                if (this.checkSpecialCombination(candy1, candy2)) {
                    this.deselect();
                    this.isBusy = false;
                    return;
                }
                
                const temp = this.board[candy1.row][candy1.col];
                this.board[candy1.row][candy1.col] = this.board[candy2.row][candy2.col];
                this.board[candy2.row][candy2.col] = temp;
                
                [candy1.row, candy2.row] = [candy2.row, candy1.row];
                [candy1.col, candy2.col] = [candy2.col, candy1.col];
                
                this.audio.playSound('swap');
                this.render();
                await this.sleep(250);
                
                const matches = this.findMatches();
                if (matches.length > 0) {
                    this.moves--;
                    this.combo++;
                    this.maxCombo = Math.max(this.maxCombo, this.combo);
                    
                    await this.processMatches(matches);
                    this.deselect();
                } else {
                    const temp = this.board[candy1.row][candy1.col];
                    this.board[candy1.row][candy1.col] = this.board[candy2.row][candy2.col];
                    this.board[candy2.row][candy2.col] = temp;
                    
                    [candy1.row, candy2.row] = [candy2.row, candy1.row];
                    [candy1.col, candy2.col] = [candy2.col, candy1.col];
                    
                    this.render();
                    this.deselect();
                    this.audio.playSound('error');
                }
                
                this.isBusy = false;
                this.updateUI();
                this.checkWin();
            }

            checkSpecialCombination(candy1, candy2) {
                if (candy1.special && candy2.special) {
                    this.activateSpecialCombination(candy1, candy2);
                    return true;
                }
                
                if (candy1.special) {
                    this.activateSpecialWithNormal(candy1, candy2);
                    return true;
                }
                if (candy2.special) {
                    this.activateSpecialWithNormal(candy2, candy1);
                    return true;
                }
                
                return false;
            }

            activateSpecialCombination(candy1, candy2) {
                let matches = [];
                const type1 = candy1.special;
                const type2 = candy2.special;
                
                this.showGameNotification(`‚ú® ${this.language.translate('two_specials_combined')}!`);
                this.stats.specialsUsed += 2;
                
                if ((type1 === 'color-bomb' && type2 === 'color-bomb') || 
                    (type2 === 'color-bomb' && type1 === 'color-bomb')) {
                    matches = this.getAllCandies();
                    this.showGameNotification(`üí• ${this.language.translate('mega_explosion')}!`);
                } 
                else if ((type1 === 'color-bomb' && type2 === 'striped') || 
                         (type2 === 'color-bomb' && type1 === 'striped')) {
                    const colorIndex = type1 === 'color-bomb' ? candy2.colorIndex : candy1.colorIndex;
                    matches = this.getCandiesByColor(colorIndex);
                    this.convertToSpecial(matches, 'striped');
                    this.showGameNotification(`üåà ${this.language.translate('all_same_color_striped')}!`);
                }
                else if ((type1 === 'striped' && type2 === 'striped')) {
                    matches = this.getCrossCandies(candy1.row, candy1.col, candy2.row, candy2.col);
                    this.showGameNotification(`‚ùå ${this.language.translate('cross_clean')}!`);
                }
                else if ((type1 === 'wrapped' && type2 === 'wrapped')) {
                    matches = this.getAreaCandies(candy1.row, candy1.col, 5);
                    this.showGameNotification(`üí£ ${this.language.translate('big_explosion')}!`);
                }
                else if ((type1 === 'fish' && type2 === 'fish')) {
                    matches = this.getRandomCandies(12);
                    this.showGameNotification(`üêüüêü ${this.language.translate('fish_swarm')}!`);
                }
                else if ((type1 === 'coconut' && type2 === 'coconut')) {
                    matches = [...this.getColumnCandies(candy1.col), ...this.getColumnCandies(candy2.col)];
                    this.showGameNotification(`ü••ü•• ${this.language.translate('double_column_clean')}!`);
                }
                
                this.processSpecialMatches(matches, 500);
                return true;
            }

            activateSpecialWithNormal(specialCandy, normalCandy) {
                let matches = [];
                this.stats.specialsUsed++;
                
                switch(specialCandy.special) {
                    case 'striped':
                        if (Math.random() > 0.5) {
                            matches = this.getRowCandies(specialCandy.row);
                            this.showGameNotification(`‚û°Ô∏è ${this.language.translate('row_cleared')}!`);
                        } else {
                            matches = this.getColumnCandies(specialCandy.col);
                            this.showGameNotification(`‚¨áÔ∏è ${this.language.translate('column_cleared')}!`);
                        }
                        break;
                        
                    case 'wrapped':
                        matches = this.getAreaCandies(specialCandy.row, specialCandy.col, 3);
                        this.showGameNotification(`üí• ${this.language.translate('area_cleared')}!`);
                        break;
                        
                    case 'color-bomb':
                        matches = this.getCandiesByColor(normalCandy.colorIndex);
                        this.showGameNotification(`üé® ${this.language.format('all_candies_cleared', normalCandy.type)}!`);
                        break;
                        
                    case 'fish':
                        matches = this.getRandomCandies(3);
                        this.showGameNotification(`üêü ${this.language.translate('fish_ate_candies')}!`);
                        break;
                        
                    case 'coconut':
                        matches = this.getColumnCandies(specialCandy.col);
                        this.showGameNotification(`ü•• ${this.language.translate('coconut_cleared_column')}!`);
                        break;
                }
                
                this.processSpecialMatches(matches, 300);
                return true;
            }

            processSpecialMatches(matches, pointsMultiplier = 100) {
                if (matches.length === 0) return;
                
                this.stats.matches += matches.length;
                this.stats.specials++;
                
                let points = matches.length * pointsMultiplier * (1 + this.combo * 0.2);
                if (this.timeBonusActive) {
                    points *= 1.1;
                }
                this.score += points;
                
                this.audio.playSound('special');
                this.particles.createBurst(window.innerWidth / 2, window.innerHeight / 2, 'special');
                
                matches.forEach(candy => {
                    if (candy.element) {
                        candy.element.classList.add('matched');
                    }
                    this.board[candy.row][candy.col] = null;
                });
                
                setTimeout(() => {
                    this.dropCandies();
                    this.fillEmpty();
                    this.render();
                    
                    setTimeout(() => {
                        const newMatches = this.findMatches();
                        if (newMatches.length > 0) {
                            this.processMatches(newMatches);
                        }
                        this.updateUI();
                        this.checkWin();
                    }, 150);
                }, 500);
                
                this.moves--;
            }

            findMatches() {
                const matches = new Set();
                
                for (let row = 0; row < this.size; row++) {
                    for (let col = 0; col < this.size - 2; col++) {
                        const candy1 = this.board[row][col];
                        const candy2 = this.board[row][col + 1];
                        const candy3 = this.board[row][col + 2];
                        
                        if (candy1 && candy2 && candy3 &&
                            candy1.type === candy2.type && 
                            candy2.type === candy3.type) {
                            matches.add(candy1);
                            matches.add(candy2);
                            matches.add(candy3);
                            
                            for (let c = col + 3; c < this.size; c++) {
                                const nextCandy = this.board[row][c];
                                if (nextCandy && nextCandy.type === candy1.type) {
                                    matches.add(nextCandy);
                                } else {
                                    break;
                                }
                            }
                        }
                    }
                }
                
                for (let col = 0; col < this.size; col++) {
                    for (let row = 0; row < this.size - 2; row++) {
                        const candy1 = this.board[row][col];
                        const candy2 = this.board[row + 1][col];
                        const candy3 = this.board[row + 2][col];
                        
                        if (candy1 && candy2 && candy3 &&
                            candy1.type === candy2.type && 
                            candy2.type === candy3.type) {
                            matches.add(candy1);
                            matches.add(candy2);
                            matches.add(candy3);
                            
                            for (let r = row + 3; r < this.size; r++) {
                                const nextCandy = this.board[r][col];
                                if (nextCandy && nextCandy.type === candy1.type) {
                                    matches.add(nextCandy);
                                } else {
                                    break;
                                }
                            }
                        }
                    }
                }
                
                return Array.from(matches);
            }

            async processMatches(matches) {
                if (matches.length === 0) return;
                
                this.stats.matches += matches.length;
                this.stats.currentStreak += matches.length;
                this.stats.maxStreak = Math.max(this.stats.maxStreak, this.stats.currentStreak);
                
                const specialCandy = this.createSpecialCandy(matches);
                if (specialCandy) {
                    this.stats.specialsCreated++;
                }
                
                let basePoints = 100 * matches.length;
                let comboBonus = this.combo * 0.2;
                let totalMultiplier = 1 + comboBonus;
                
                let points = Math.floor(basePoints * totalMultiplier);
                this.score += points;
                
                this.audio.playSound(this.combo > 1 ? 'combo' : 'match');
                this.particles.createBurst(window.innerWidth / 2, window.innerHeight / 2, 'match');
                
                if (matches.length >= 5) {
                    this.showGameNotification(`üî• ${this.language.translate('awesome_5_matches')}!`);
                } else if (matches.length === 4) {
                    this.showGameNotification(`‚ú® ${this.language.translate('great_4_matches')}!`);
                } else if (this.combo > 3) {
                    this.showGameNotification(`üéØ ${this.language.format('combo_x', this.combo)}!`);
                }
                
                matches.forEach(candy => {
                    if (candy.element) {
                        candy.element.classList.add('matched');
                    }
                    this.board[candy.row][candy.col] = null;
                });
                
                await this.sleep(500);
                
                this.dropCandies();
                this.fillEmpty();
                
                await this.sleep(150);
                
                const newMatches = this.findMatches();
                if (newMatches.length > 0) {
                    await this.processMatches(newMatches);
                } else {
                    this.combo = 0;
                    this.stats.currentStreak = 0;
                }
            }

            createSpecialCandy(matches) {
                if (matches.length >= 5) {
                    const center = matches[Math.floor(matches.length / 2)];
                    center.special = 'color-bomb';
                    center.isSpecial = true;
                    this.stats.specials++;
                    this.showGameNotification(`üí£ ${this.language.translate('color_bomb_created')}!`);
                    return center;
                } else if (matches.length === 4) {
                    const center = matches[Math.floor(matches.length / 2)];
                    const isHorizontal = this.checkHorizontalMatch(matches);
                    center.special = isHorizontal ? 'striped' : 'wrapped';
                    center.isSpecial = true;
                    this.stats.specials++;
                    this.showGameNotification(isHorizontal ? 
                        `üéá ${this.language.translate('striped_candy_created')}!` : 
                        `üéÅ ${this.language.translate('wrapped_candy_created')}!`);
                    return center;
                } else if (matches.length === 3) {
                    if (Math.random() < 0.1) {
                        const center = matches[Math.floor(matches.length / 2)];
                        center.special = Math.random() > 0.5 ? 'fish' : 'coconut';
                        center.isSpecial = true;
                        this.stats.specials++;
                        this.showGameNotification(center.special === 'fish' ? 
                            `üêü ${this.language.translate('fish_created')}!` : 
                            `ü•• ${this.language.translate('coconut_created')}!`);
                        return center;
                    }
                }
                return null;
            }

            checkHorizontalMatch(matches) {
                const firstRow = matches[0].row;
                return matches.every(candy => candy.row === firstRow);
            }

            dropCandies() {
                for (let col = 0; col < this.size; col++) {
                    let emptyRow = this.size - 1;
                    
                    for (let row = this.size - 1; row >= 0; row--) {
                        if (this.board[row][col]) {
                            if (row !== emptyRow) {
                                this.board[emptyRow][col] = this.board[row][col];
                                this.board[emptyRow][col].row = emptyRow;
                                this.board[row][col] = null;
                            }
                            emptyRow--;
                        }
                    }
                }
            }

            fillEmpty() {
                for (let row = 0; row < this.size; row++) {
                    for (let col = 0; col < this.size; col++) {
                        if (!this.board[row][col]) {
                            this.board[row][col] = this.createCandy(row, col);
                        }
                    }
                }
                this.render();
            }

            getAllCandies() {
                const allCandies = [];
                for (let row = 0; row < this.size; row++) {
                    for (let col = 0; col < this.size; col++) {
                        if (this.board[row][col]) {
                            allCandies.push(this.board[row][col]);
                        }
                    }
                }
                return allCandies;
            }

            getCandiesByColor(colorIndex) {
                const candies = [];
                for (let row = 0; row < this.size; row++) {
                    for (let col = 0; col < this.size; col++) {
                        const candy = this.board[row][col];
                        if (candy && candy.colorIndex === colorIndex) {
                            candies.push(candy);
                        }
                    }
                }
                return candies;
            }

            getRowCandies(row) {
                const candies = [];
                for (let col = 0; col < this.size; col++) {
                    if (this.board[row][col]) {
                        candies.push(this.board[row][col]);
                    }
                }
                return candies;
            }

            getColumnCandies(col) {
                const candies = [];
                for (let row = 0; row < this.size; row++) {
                    if (this.board[row][col]) {
                        candies.push(this.board[row][col]);
                    }
                }
                return candies;
            }

            getAreaCandies(row, col, size) {
                const candies = [];
                const halfSize = Math.floor(size / 2);
                const startRow = Math.max(0, row - halfSize);
                const endRow = Math.min(this.size - 1, row + halfSize);
                const startCol = Math.max(0, col - halfSize);
                const endCol = Math.min(this.size - 1, col + halfSize);
                
                for (let r = startRow; r <= endRow; r++) {
                    for (let c = startCol; c <= endCol; c++) {
                        if (this.board[r][c]) {
                            candies.push(this.board[r][c]);
                        }
                    }
                }
                return candies;
            }

            getCrossCandies(row1, col1, row2, col2) {
                const candies = new Set();
                
                for (let col = 0; col < this.size; col++) {
                    if (this.board[row1][col]) {
                        candies.add(this.board[row1][col]);
                    }
                }
                for (let row = 0; row < this.size; row++) {
                    if (this.board[row][col1]) {
                        candies.add(this.board[row][col1]);
                    }
                }
                
                for (let col = 0; col < this.size; col++) {
                    if (this.board[row2][col]) {
                        candies.add(this.board[row2][col]);
                    }
                }
                for (let row = 0; row < this.size; row++) {
                    if (this.board[row][col2]) {
                        candies.add(this.board[row][col2]);
                    }
                }
                
                return Array.from(candies);
            }

            getRandomCandies(count) {
                const allCandies = this.getAllCandies();
                const shuffled = [...allCandies].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, Math.min(count, shuffled.length));
            }

            convertToSpecial(candies, specialType) {
                candies.forEach(candy => {
                    candy.special = specialType;
                    candy.isSpecial = true;
                });
            }

            updateUI() {
                document.getElementById('score-display').textContent = this.score.toLocaleString(this.language.currentLang);
                document.getElementById('moves-display').textContent = this.moves;
                document.getElementById('level-display').textContent = this.level;
            }

            checkWin() {
                if (this.score >= this.target) {
                    this.win();
                } else if (this.moves <= 0) {
                    this.lose();
                }
            }

            win() {
                if (this.timeInterval) {
                    clearInterval(this.timeInterval);
                    this.timeInterval = null;
                }
                
                const stats = this.storage.get('stats');
                stats.totalGames = (stats.totalGames || 0) + 1;
                stats.totalScore = (stats.totalScore || 0) + this.score;
                stats.totalTime = (stats.totalTime || 0) + this.gameTime * 1000;
                stats.bestCombo = Math.max(stats.bestCombo || 0, this.maxCombo);
                stats.bestScore = Math.max(stats.bestScore || 0, this.score);
                stats.specialCandiesCreated = (stats.specialCandiesCreated || 0) + this.stats.specialsCreated;
                stats.totalMatches = (stats.totalMatches || 0) + this.stats.matches;
                
                const levelTimes = stats.levelTimes || {};
                const currentTime = levelTimes[this.level] || Infinity;
                if (this.gameTime < currentTime) {
                    levelTimes[this.level] = this.gameTime;
                }
                stats.levelTimes = levelTimes;
                
                const levelStars = stats.levelStars || {};
                const stars = this.calculateStars();
                levelStars[this.level] = Math.max(levelStars[this.level] || 0, stars);
                stats.levelStars = levelStars;
                
                const completedLevels = Object.keys(levelTimes).length;
                stats.completedLevels = completedLevels;
                
                const progress = this.storage.get('progress');
                progress.currentLevel = Math.min(this.level + 1, 100);
                progress.unlockedLevels = Math.max(progress.unlockedLevels || 1, progress.currentLevel);
                
                this.storage.set('stats', stats);
                this.storage.set('progress', progress);
                
                this.fillGameOver(true);
                this.showModal('game-over-modal');
                this.audio.playSound('win');
            }

            lose() {
                if (this.timeInterval) {
                    clearInterval(this.timeInterval);
                    this.timeInterval = null;
                }
                this.fillGameOver(false);
                this.showModal('game-over-modal');
                this.audio.playSound('lose');
            }

            calculateStars() {
                const percent = this.score / this.target;
                if (percent >= 1.5) return 3;
                if (percent >= 1.2) return 2;
                if (percent >= 1) return 1;
                return 0;
            }

            fillGameOver(won) {
                const title = won ? 
                    `üéâ ${this.language.translate('level_completed')}` : 
                    `üòî ${this.language.translate('game_over')}`;
                document.getElementById('game-over-title').textContent = title;
                
                document.getElementById('final-score').textContent = this.score.toLocaleString(this.language.currentLang);
                
                const min = Math.floor(this.gameTime / 60);
                const sec = (this.gameTime % 60).toString().padStart(2, '0');
                document.getElementById('level-time').textContent = `${min}:${sec}`;
                document.getElementById('max-combo').textContent = this.maxCombo;
                document.getElementById('special-count').textContent = this.stats.specials;
                const efficiency = this.target > 0 ? Math.round((this.score / this.target) * 100) : 0;
                document.getElementById('efficiency').textContent = efficiency;
                
                document.getElementById('next-level-btn').style.display = won ? 'flex' : 'none';
            }

            nextLevel() {
                this.hideModal('game-over-modal');
                this.loadLevel(this.level + 1);
                this.showToast(this.language.format('level_start', this.level));
            }

            restartLevel() {
                this.hideModal('game-over-modal');
                this.loadLevel(this.level);
            }

            applySettings() {
                const settings = this.storage.get('settings');
                this.particles.enabled = settings.effects;
                
                if (settings.darkMode) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
                
                document.getElementById('sfx-volume').value = settings.sfx;
                document.getElementById('music-volume').value = settings.music;
                document.getElementById('effects-toggle').checked = settings.effects;
                document.getElementById('dark-mode-toggle').checked = settings.darkMode;
                
                document.getElementById('sfx-value').textContent = `${settings.sfx}%`;
                document.getElementById('music-value').textContent = `${settings.music}%`;
            }

            updateStats() {
                const stats = this.storage.get('stats');
                const progress = this.storage.get('progress');
                const levelTimes = stats.levelTimes || {};
                const levelStars = stats.levelStars || {};
                
                document.getElementById('total-games').textContent = stats.totalGames || 0;
                document.getElementById('total-score').textContent = (stats.totalScore || 0).toLocaleString(this.language.currentLang);
                document.getElementById('total-time').textContent = this.formatTime(stats.totalTime || 0);
                document.getElementById('best-combo').textContent = stats.bestCombo || 0;
                
                document.getElementById('best-score').textContent = (stats.bestScore || 0).toLocaleString(this.language.currentLang);
                
                let fastestLevel = null;
                let fastestTime = Infinity;
                Object.keys(levelTimes).forEach(level => {
                    if (levelTimes[level] < fastestTime) {
                        fastestTime = levelTimes[level];
                        fastestLevel = level;
                    }
                });
                
                if (fastestLevel) {
                    const min = Math.floor(fastestTime / 60);
                    const sec = (fastestTime % 60).toString().padStart(2, '0');
                    document.getElementById('fastest-level').textContent = 
                        `${this.language.translate('level')} ${fastestLevel}: ${min}:${sec}`;
                } else {
                    document.getElementById('fastest-level').textContent = '-';
                }
                
                const completedLevels = Object.keys(levelTimes).length;
                document.getElementById('completed-levels').textContent = `${completedLevels}/100`;
                
                document.getElementById('total-specials').textContent = stats.specialCandiesCreated || 0;
                document.getElementById('total-matches').textContent = stats.totalMatches || 0;
                
                const levelTimesContainer = document.getElementById('level-times');
                if (!levelTimesContainer) return;
                
                levelTimesContainer.innerHTML = '';
                
                const sortedLevels = Object.keys(levelTimes).sort((a, b) => b - a).slice(0, 10);
                
                if (sortedLevels.length === 0) {
                    levelTimesContainer.innerHTML = 
                        `<div class="text-center" style="color:#999; padding:15px; font-size:14px;">
                            ${this.language.translate('no_levels_completed')}
                        </div>`;
                } else {
                    sortedLevels.forEach(level => {
                        const time = levelTimes[level];
                        const stars = levelStars[level] || 0;
                        const min = Math.floor(time / 60);
                        const sec = (time % 60).toString().padStart(2, '0');
                        
                        const item = document.createElement('div');
                        item.className = 'level-time-item';
                        item.innerHTML = `
                            <div class="level-time-number">${this.language.translate('level')} ${level}</div>
                            <div>
                                <div class="level-time-value">${min}:${sec}</div>
                                ${stars > 0 ? `<div style="font-size:10px; color:var(--gold);">${'‚≠ê'.repeat(stars)}</div>` : ''}
                            </div>
                        `;
                        levelTimesContainer.appendChild(item);
                    });
                }
            }

            formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                
                if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else if (minutes > 0) {
                    return `${minutes}m ${seconds}s`;
                } else {
                    return `${seconds}s`;
                }
            }

            adjustBoardSize() {
                const gameContainer = document.getElementById('game-container');
                if (!gameContainer) return;
                
                const screenWidth = window.innerWidth;
                const containerWidth = Math.min(screenWidth - 30, 450);
                
                const horizontalPadding = 30;
                const boardPadding = 20;
                const gapSize = 1;
                
                const availableWidth = containerWidth - horizontalPadding - boardPadding;
                
                const candySize = Math.max(36, Math.min(50, (availableWidth - (7 * gapSize)) / 8));
                
                document.documentElement.style.setProperty('--candy-size', `${candySize}px`);
                
                if (this.board.length > 0) {
                    this.render();
                }
            }

            calculateCandySize() {
                const computedStyle = getComputedStyle(document.documentElement);
                const candySize = parseFloat(computedStyle.getPropertyValue('--candy-size'));
                return candySize || 40;
            }

            showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.remove('hidden');
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 300);
                }, 2500);
            }

            showGameNotification(message) {
                const now = Date.now();
                if (now - this.lastNotificationTime > 2000) {
                    this.showToast(message);
                    this.lastNotificationTime = now;
                }
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // === OYUNU BA≈ûLAT ===
        window.addEventListener('DOMContentLoaded', () => {
            document.addEventListener('touchmove', (e) => {
                if (e.target.closest('#game-board') || e.target.closest('.modal')) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            window.game = new MixCrushGame();
            
            function adjustLayout() {
                if (window.game && window.game.adjustBoardSize) {
                    window.game.adjustBoardSize();
                }
            }
            
            adjustLayout();
            window.addEventListener('resize', adjustLayout);
            window.addEventListener('orientationchange', () => {
                setTimeout(adjustLayout, 100);
            });
        });
    </script>
</body>
</html>
